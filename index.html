<!-- 
    HOBOPAD REVISION NOTE
    - Increment version by 0.0.1
    - Change {fut} to a new random Futurama character.
    - Refactored to support dynamic theme loading from external CSS files.
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Hobopad</title>
    
    <link rel="icon" type="image/x-icon" href="https://busland.neocities.org/hobopad.ico">
    <link rel="manifest" href="manifest.json">

    <style>
        /* --- Base Styles (Theme-Independent) --- */
        html, body { height: 100%; margin: 0; padding: 0; overflow: hidden; font-family: "Tahoma", "Geneva", sans-serif; transition: background-color 0.3s; }
        #app-window, #file-manager-window { width: 100vw; height: 100vh; display: flex; flex-direction: column; box-sizing: border-box; overflow: hidden; }
        .modal-content { width: 100%; display: flex; flex-direction: column; box-sizing: border-box; overflow: hidden; flex-shrink: 1; min-height: 0; }
        .title-bar { display: flex; justify-content: space-between; align-items: center; position: relative; flex-shrink: 0; }
        .window-body { display: flex; flex-direction: column; flex-grow: 1; margin: 0; padding: 0; min-height: 0; }
        .menu-bar { flex-shrink: 0; position: relative; z-index: 10; }
        #editor { flex-grow: 1; padding: 5px; margin: 0; resize: none; outline: none; line-height: 1.6; width: 100%; box-sizing: border-box; overflow-y: scroll; border: none; }
        .modal { display: none; width: 90%; max-width: 340px; max-height: 80vh; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 200; flex-direction: column; }
        #about-modal, #font-size-modal, #replace-modal, #import-export-modal { max-width: 300px; }
        .modal .window-body { overflow-y: auto; padding: 10px; }
        .field-row { display: flex; justify-content: flex-end; gap: 8px; margin-top: 15px; }
        #file-opener, #import-file-opener { display: none; }

        #about-modal .window-body {
            background-image: url('about.png');
            background-size: cover;
            background-position: center;
        }
        #about-modal p {
            color: #222;
            text-shadow: 0 0 4px white, 0 0 6px white;
        }
        #font-size-display { text-align: center; margin-top: 10px; }
        #import-export-modal .window-body { display: flex; flex-wrap: wrap; justify-content: space-around; text-align: center; padding-top: 20px; padding-bottom: 10px; }
        .io-section { width: 45%; margin-bottom: 10px; }
        .io-section button { width: 80px; height: 60px; font-size: 2em; line-height: 1; }
        .io-section p { margin-top: 5px; font-size: 0.9em; }
        .io-warning { width: 100%; color: #888; font-size: 0.8em; text-align: center; margin-top: 15px; }
        .menu-item { position: relative; user-select: none; }
        .dropdown-content { display: none; position: absolute; top: 100%; right: 0; background-color: #f9f9f9; min-width: 160px; box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2); z-index: 100; list-style: none; padding: 0; margin: 0; }
        .menu-item:not(.menu-item-right) .dropdown-content { right: auto; left: 0; }
        .dropdown-content li { padding: 8px 12px; cursor: pointer; color: black; border-bottom: 1px solid #ddd; }
        .dropdown-content li:last-child { border-bottom: none; }
        #file-manager-window { position: fixed; top: 0; left: 0; z-index: 200; display: none; }
        #file-manager-content { display: flex; flex-grow: 1; min-height: 0; }
        #notes-list-container { width: 40%; display: flex; flex-direction: column; border-right: 1px solid; }
        .notes-list-header { display: flex; padding: 4px 8px; font-weight: bold; border-bottom: 1px solid; flex-shrink: 0; align-items: center; }
        .header-name { flex-grow: 1; }
        #note-preview-container { width: 60%; display: flex; flex-direction: column; }
        #note-preview-header { padding: 8px; border-bottom: 1px solid; flex-shrink: 0; }
        #note-preview-title { font-weight: bold; font-size: 1.2em; }
        #note-preview-date { font-size: 0.9em; opacity: 0.8; }
        #note-preview-actions { margin-top: 8px; display: flex; gap: 8px; }
        #note-preview { flex-grow: 1; padding: 10px; overflow-y: auto; white-space: pre-wrap; }
        .note-item { display: flex; align-items: flex-start; padding: 8px; cursor: pointer; border-bottom: 1px solid; gap: 8px; margin-bottom: 5px; }
        .note-item .file-icon { width: 16px; height: 16px; flex-shrink: 0; margin-top: 2px; }
        .note-item-details { flex-grow: 1; display: flex; flex-direction: column; }
        .note-item-title { font-weight: bold; }
        .note-item-date { font-size: 0.9em; opacity: 0.8; }
        #file-manager-back-btn-ios, #file-manager-back-btn-android { display: none; }
        #version-tag { text-align: center; font-size: 2.5cqw; margin-top: 15px; margin-bottom: 0px; }
        @media (max-width: 640px) {
            #about-modal { width: 90vw; height: 90vw; max-width: none; max-height: none; }
            #about-modal .modal-content { height: 100%; }
        }
    </style>
</head>
<body> 
    <div id="app-window">
        <div class="title-bar">
            <div class="title-bar-text">Hobopad</div>
            <div class="title-bar-controls">
                <button id="minimize-btn" class="win-button" aria-label="Minimize"><span class="icon minimize-icon"></span></button>
                <button id="maximize-btn" class="win-button" aria-label="Maximize"><span class="icon maximize-icon"></span></button>
                <button id="close-btn" class="win-button" aria-label="Close"><span class="icon close-icon"></span></button>
            </div>
        </div>
        <ul class="menu-bar">
            <li class="menu-item">
                File
                <ul class="dropdown-content">
                    <li id="new-file-btn">New Note</li>
                    <li id="open-file-btn">Open from Device...</li>
                    <li id="save-note-btn">Save Note</li>
                    <li id="save-to-device-btn">Save to Device...</li>
                </ul>
            </li>
            <li id="saved-notes-btn">Saved Notes</li>
            <li class="menu-item menu-item-right">
                Styles
                <ul id="styles-dropdown-menu" class="dropdown-content">
                    <!-- Theme list will be dynamically populated here -->
                </ul>
            </li>
            <li class="menu-item menu-item-right">
                Tools
                <ul class="dropdown-content">
                    <li id="font-size-menu-btn">Font Size</li>
                    <li id="replace-menu-btn">Replace</li>
                    <li id="import-export-btn">Import/Export</li>
                    <li id="dark-mode-toggle">Light Mode</li>
                    <li id="about-menu-btn">About</li>
                </ul>
            </li>
        </ul>
        <div class="window-body">
            <textarea id="editor" spellcheck="false"></textarea>
        </div>
    </div>

    <!-- Modals and other elements remain the same -->
    <div id="about-modal" class="modal">
        <div class="modal-content">
            <div class="title-bar"><div class="title-bar-text">About Hobopad</div></div>
            <div class="window-body">
                <p id="version-tag">[Version 1.0.1] (Scruffy)</p>
                <p style="text-align: center; margin: 20px; font-size: 3.5cqw;">
                    This shitty app was vibe coded by an absolute complete dumbass who was sick of all your shitty note apps....<br><br>
                    Like who the fuck wants a note taking app to open DIRECTLY to the saved notes, showing you every single note with just enough of a snippet to raise suspicion.<br><br>
                    Get better you fucking weirdos.
                </p>
                <p style="text-align: center; font-size: 2.5cqw; margin: 10px;">Oh and if you lose your saved notes, that's 100% on you bud, don't blame me, dumbass.</p>
                <section class="field-row" style="font-size: 3cqw;"><button id="close-modal-1">get fucked</button><button id="close-modal-2" class="primary">dumbass</button></section>
            </div>
        </div>
    </div>

    <div id="save-note-modal" class="modal">
         <div class="modal-content">
            <div class="title-bar"><div class="title-bar-text">Save Note</div></div>
            <div class="window-body">
                <label for="note-name-input" style="display: block; margin-bottom: 8px;">Note Name:</label>
                <input type="text" id="note-name-input" value="">
                <section class="field-row"><button id="cancel-note-save-btn">Cancel</button><button id="confirm-note-save-btn" class="primary">Save</button></section>
            </div>
        </div>
    </div>

    <div id="save-to-device-modal" class="modal">
         <div class="modal-content">
            <div class="title-bar"><div class="title-bar-text">Save to Device</div></div>
            <div class="window-body">
                <label for="device-filename-input" style="display: block; margin-bottom: 8px;">File Name:</label>
                <input type="text" id="device-filename-input" value="">
                <label for="file-type-select" style="display: block; margin-top: 10px; margin-bottom: 8px;">File Type:</label>
                <select id="file-type-select">
                    <option value="txt">.txt (Text File)</option>
                    <option value="html">.html (HTML File)</option>
                </select>
                <section class="field-row"><button id="cancel-device-save-btn">Cancel</button><button id="confirm-device-save-btn" class="primary">Save</button></section>
            </div>
        </div>
    </div>

    <div id="font-size-modal" class="modal">
         <div class="modal-content">
           <div class="title-bar"><div class="title-bar-text">Adjust Font Size</div></div>
           <div class="window-body">
               <input type="range" id="font-size-slider" min="8" max="48" value="16">
               <p id="font-size-display">16px</p>
               <section class="field-row"><button id="close-font-modal-btn">Close</button></section>
           </div>
       </div>
    </div>

    <div id="replace-modal" class="modal">
        <div class="modal-content">
            <div class="title-bar"><div class="title-bar-text">Replace</div></div>
            <div class="window-body">
                <label for="find-input">Find:</label>
                <input type="text" id="find-input">
                <label for="replace-input" style="margin-top: 10px;">Replace with:</label>
                <input type="text" id="replace-input">
                <section class="field-row">
                    <button id="confirm-replace-all-btn">Replace All</button>
                    <button id="close-replace-btn">Close</button>
                </section>
            </div>
        </div>
    </div>

    <div id="import-export-modal" class="modal">
        <div class="modal-content">
            <div class="title-bar"><div class="title-bar-text">Import/Export Notes</div></div>
            <div class="window-body">
                <div class="io-section">
                    <button id="import-notes-btn">📥</button>
                    <p>Import Notes</p>
                </div>
                <div class="io-section">
                    <button id="export-notes-btn">📤</button>
                    <p>Export Notes</p>
                </div>
                <p class="io-warning">any lost notes are 100% your own fault for trusting this shit.</p>
            </div>
            <section class="field-row">
                <button id="close-io-modal-btn">Close</button>
            </section>
        </div>
    </div>

    <input type="file" id="file-opener" accept=".txt,text/plain">
    <input type="file" id="import-file-opener" accept=".json,application/json">

    <div id="file-manager-window">
        <div class="title-bar">
            <button id="file-manager-back-btn-ios">&lt; Back</button>
            <button id="file-manager-back-btn-android" aria-label="Back">
                <svg viewBox="0 0 24 24" width="24" height="24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"></path></svg>
            </button>
            <div class="title-bar-text">Saved Notes</div>
            <div class="title-bar-controls">
                <button id="file-manager-close-btn" class="win-button" aria-label="Close"><span class="icon close-icon"></span></button>
            </div>
        </div>
        <div class="window-body">
             <div id="file-manager-content">
                <div id="notes-list-container">
                    <div class="notes-list-header">
                        <span class="header-name">Name</span>
                        <div class="menu-item">
                            <button id="filter-btn">Filter</button>
                            <ul class="dropdown-content">
                                <li data-sort="name-asc">Name (A-Z)</li>
                                <li data-sort="name-desc">Name (Z-A)</li>
                                <li data-sort="date-desc">Newest First</li>
                                <li data-sort="date-asc">Oldest First</li>
                            </ul>
                        </div>
                    </div>
                    <div id="notes-list"></div>
                </div>
                <div id="note-preview-container">
                    <div id="note-preview-header">
                        <div id="note-preview-title"></div>
                        <div id="note-preview-date"></div>
                        <div id="note-preview-actions">
                            <button id="preview-open-btn">Open in Editor</button>
                            <button id="preview-delete-btn">Delete</button>
                        </div>
                    </div>
                    <div id="note-preview">Select a note to preview...</div>
                </div>
            </div>
        </div>
    </div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const getEl = id => document.getElementById(id);

        /**
         * THEME CONFIGURATION
         * This array acts as a virtual directory for the /styles/ folder.
         * To add a new theme:
         * 1. Create a new .css file in the /styles/ folder.
         * 2. Add a new object to this array with the theme's details.
         * - id: The CSS class name (e.g., 'theme-win95').
         * - name: The display name for the dropdown menu (e.g., 'Windows 95').
         * - file: The path to the CSS file (e.g., 'styles/win95.css').
         */
        const themes = [
            { id: 'theme-win95', name: 'Windows 95', file: 'styles/win95.css' },
            { id: 'theme-winxp', name: 'Windows XP', file: 'styles/winxp.css' },
            { id: 'theme-macos', name: 'Mac OS X', file: 'styles/macos.css' },
            { id: 'theme-ios', name: 'iOS', file: 'styles/ios.css' },
            { id: 'theme-android', name: 'Android', file: 'styles/android.css' },
        ];

        // --- State ---
        let currentNoteId = null;
        let selectedPreviewId = null;
        let isDirty = false;
        let autosaveTimeout = null;

        // --- Element Cache ---
        const editor = getEl('editor');
        const fileOpener = getEl('file-opener');
        const importFileOpener = getEl('import-file-opener');
        const closeBtn = getEl('close-btn');
        const titleBarText = document.querySelector('#app-window .title-bar-text');
        const darkModeToggle = getEl('dark-mode-toggle');
        const stylesDropdownMenu = getEl('styles-dropdown-menu');

        // --- Theme Switcher Logic ---
        const setTheme = (themeId) => {
            const theme = themes.find(t => t.id === themeId);
            if (!theme) {
                console.error(`Theme with id "${themeId}" not found.`);
                return;
            }

            // Remove the old stylesheet if it exists
            const oldLink = document.getElementById('theme-stylesheet');
            if (oldLink) {
                oldLink.remove();
            }

            // Create and append the new stylesheet link
            const newLink = document.createElement('link');
            newLink.id = 'theme-stylesheet';
            newLink.rel = 'stylesheet';
            newLink.href = theme.file;
            document.head.appendChild(newLink);

            // Apply the theme class to the body, preserving dark mode if active
            const isDark = document.body.classList.contains('dark-mode');
            document.body.className = isDark ? `dark-mode ${theme.id}` : theme.id;

            // Save the preference
            localStorage.setItem('hobopad_theme_id', theme.id);
        };

        const populateStylesMenu = () => {
            stylesDropdownMenu.innerHTML = ''; // Clear existing items
            themes.forEach(theme => {
                const li = document.createElement('li');
                li.textContent = theme.name;
                li.dataset.themeId = theme.id;
                stylesDropdownMenu.appendChild(li);
            });
        };

        stylesDropdownMenu.addEventListener('click', (event) => {
            if (event.target.tagName === 'LI' && event.target.dataset.themeId) {
                setTheme(event.target.dataset.themeId);
                closeAllDropdowns();
            }
        });

        // --- Dark Mode Logic ---
        const setDarkMode = (isDark) => {
            const currentThemeId = localStorage.getItem('hobopad_theme_id') || themes[0].id;
            const theme = themes.find(t => t.id === currentThemeId);
            
            if (isDark) {
                document.body.classList.add('dark-mode');
                darkModeToggle.textContent = 'Dark Mode';
                localStorage.setItem('hobopad_darkmode', 'enabled');
            } else {
                document.body.classList.remove('dark-mode');
                darkModeToggle.textContent = 'Light Mode';
                localStorage.setItem('hobopad_darkmode', 'disabled');
            }
            // Re-apply the class to ensure proper cascading
            document.body.className = isDark ? `dark-mode ${theme.id}` : theme.id;
        };

        darkModeToggle.addEventListener('click', () => {
            setDarkMode(!document.body.classList.contains('dark-mode'));
        });

        // --- Dropdown Menu Logic ---
        const closeAllDropdowns = () => {
            document.querySelectorAll('.dropdown-content').forEach(d => d.style.display = 'none');
        };

        document.querySelectorAll('.menu-item').forEach(item => {
            const hasDropdown = item.querySelector('.dropdown-content');
            item.addEventListener('click', event => {
                if (hasDropdown && event.target.closest('.dropdown-content')) {
                    return;
                }
                event.stopPropagation();
                if (hasDropdown) {
                    const dropdown = item.querySelector('.dropdown-content');
                    const isVisible = dropdown.style.display === 'block';
                    closeAllDropdowns();
                    if (!isVisible) {
                        dropdown.style.display = 'block';
                    }
                } else {
                    closeAllDropdowns();
                }
            });
        });
        window.addEventListener('click', closeAllDropdowns);

        // --- Initialization ---
        const initializeApp = () => {
            // 1. Populate the styles menu
            populateStylesMenu();

            // 2. Set the initial theme
            const savedThemeId = localStorage.getItem('hobopad_theme_id') || themes[0].id;
            setTheme(savedThemeId);

            // 3. Set the initial dark mode state
            const savedDarkMode = localStorage.getItem('hobopad_darkmode');
            const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
            if (savedDarkMode === 'enabled' || (savedDarkMode === null && prefersDark)) {
                setDarkMode(true);
            } else {
                setDarkMode(false);
            }

            // 4. Initialize with default title
            updateTitleBar('Untitled');
        };
        
        // --- All other application logic (save, open, modals, etc.) remains the same ---
        // --- It has been omitted here for brevity but should be copied from the previous version ---

        const updateTitleBar = (noteName, showSavedMessage = false) => {
            const baseTitle = `${noteName || 'Untitled'} - Hobopad`;
            titleBarText.textContent = baseTitle;
            if (showSavedMessage) {
                titleBarText.textContent = `✓ Saved - ${noteName || 'Untitled'} - Hobopad`;
                setTimeout(() => {
                    if (titleBarText.textContent.startsWith('✓ Saved')) {
                        titleBarText.textContent = baseTitle;
                    }
                }, 1500);
            }
        };

        getEl('new-file-btn').addEventListener('click', () => {
            editor.value = '';
            currentNoteId = null;
            isDirty = false;
            updateTitleBar('Untitled');
        });

        openFileBtn.addEventListener('click', () => { fileOpener.click(); });
        fileOpener.addEventListener('change', event => {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = e => { editor.value = e.target.result; };
            reader.readAsText(file);
            event.target.value = null; 
            currentNoteId = null;
            isDirty = false;
            updateTitleBar(file.name.replace(/\.[^/.]+$/, ""));
        });

        const saveNoteToLocalStorage = (name, isAutosave = false) => {
            let notes = JSON.parse(localStorage.getItem('hobopad_notes') || '[]');
            let noteName = name.trim() || 'Untitled';
            let savedNoteName = noteName;

            if (currentNoteId) {
                const note = notes.find(n => n.id === currentNoteId);
                if (note) {
                    note.content = editor.value;
                    note.createdAt = Date.now();
                    note.name = noteName;
                    savedNoteName = note.name;
                }
            } else {
                const note = { id: Date.now(), name: noteName, content: editor.value, createdAt: Date.now() };
                notes.unshift(note);
                currentNoteId = note.id;
                savedNoteName = note.name;
            }
            localStorage.setItem('hobopad_notes', JSON.stringify(notes));
            isDirty = false;
            
            if (isAutosave) {
                updateTitleBar(savedNoteName, true);
            } else {
                updateTitleBar(savedNoteName);
            }
        };
        
        const saveNoteModal = getEl('save-note-modal');
        getEl('save-note-btn').addEventListener('click', () => {
            if (currentNoteId) {
                const notes = JSON.parse(localStorage.getItem('hobopad_notes') || '[]');
                const note = notes.find(n => n.id === currentNoteId);
                saveNoteToLocalStorage(note.name);
                alert('Note updated!');
            } else {
                saveNoteModal.style.display = 'flex';
                getEl('note-name-input').focus();
            }
        });
        getEl('cancel-note-save-btn').addEventListener('click', () => { saveNoteModal.style.display = 'none'; });
        getEl('confirm-note-save-btn').addEventListener('click', () => {
            saveNoteToLocalStorage(getEl('note-name-input').value);
            saveNoteModal.style.display = 'none';
        });

        // --- Run the app ---
        initializeApp();
    });
</script>
</body>
</html>
