<!DOCTYPE html>
<html lang="en">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
Â  Â  <title>AFSNote</title>
Â  Â  <link rel="icon" type="image/x-icon" href="https://busland.neocities.org/hobopad.ico">
Â  Â  <link rel="manifest" href="manifest.json">

Â  Â  <style>
Â  Â  Â  Â  /* --- Base Styles --- */
Â  Â  Â  Â  html, body { height: 100%; margin: 0; padding: 0; overflow: hidden; font-family: "Tahoma", "Geneva", sans-serif; transition: background-color 0.3s; }
Â  Â  Â  Â  #app-window, #file-manager-window { width: 100vw; height: 100vh; display: flex; flex-direction: column; box-sizing: border-box; overflow: hidden; }
Â  Â  Â  Â  .modal-content { width: 100%; display: flex; flex-direction: column; box-sizing: border-box; overflow: hidden; flex-shrink: 1; min-height: 0; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* Updated Title Bar Styles */
Â  Â  Â  Â  .title-bar {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: space-between;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  Â  Â  flex-shrink: 0;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .title-bar-text {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  left: 0;
Â  Â  Â  Â  Â  Â  right: 0;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  pointer-events: none;
Â  Â  Â  Â  Â  Â  z-index: 1;
Â  Â  Â  Â  Â  Â  padding: 0 60px;
            white-space: nowrap;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .title-bar-controls {
Â  Â  Â  Â  Â  Â  margin-left: auto;
Â  Â  Â  Â  Â  Â  z-index: 2;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  gap: 3px;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .window-body { display: flex; flex-direction: column; flex-grow: 1; margin: 0; padding: 0; min-height: 0; }
Â  Â  Â  Â  .menu-bar { flex-shrink: 0; position: relative; z-index: 10; }
Â  Â  Â  Â  #editor { flex-grow: 1; padding: 5px; margin: 0; resize: none; outline: none; line-height: 1.6; width: 100%; box-sizing: border-box; overflow-y: scroll; border: none; }
Â  Â  Â  Â  .modal { display: none; width: 90%; max-width: 340px; max-height: 80vh; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 201; flex-direction: column; }
Â  Â  Â  Â  #font-size-modal, #replace-modal, #import-export-modal { max-width: 300px; }
Â  Â  Â  Â  #about-modal {
Â  Â  Â  Â  Â  Â  width: 90vmin;
Â  Â  Â  Â  Â  Â  height: 90vmin;
Â  Â  Â  Â  Â  Â  max-width: 680px;
Â  Â  Â  Â  Â  Â  max-height: 680px;
Â  Â  Â  Â  Â  Â  container-type: inline-size;
Â  Â  Â  Â  }
Â  Â  Â  Â  .modal .window-body { : auto; padding: 10px; }
Â  Â  Â  Â  .field-row { display: flex; justify-content: flex-end; gap: 8px; margin-top: 15px; }
Â  Â  Â  Â  #file-opener, #import-file-opener { display: none; }

Â  Â  Â  Â  /* --- Custom About Modal Background --- */
Â  Â  Â  Â  #about-modal p {
Â  Â  Â  Â  Â  Â  color: #222;
Â  Â  Â  Â  }
Â  Â  Â  Â  .dark-mode #about-modal p {
Â  Â  Â  Â  Â  Â  color: #e0e0e0;
Â  Â  Â  Â  }
Â  Â  Â  Â  #about-modal .window-body p:first-of-type {
Â  Â  Â  Â  Â  Â  font-size: 3.5cqw;
Â  Â  Â  Â  }
Â  Â  Â  Â  #about-modal .window-body p:nth-of-type(2) {
Â  Â  Â  Â  Â  Â  font-size: 2.5cqw;
Â  Â  Â  Â  }
Â  Â  Â  Â  #about-modal .window-body .field-row {
Â  Â  Â  Â  Â  Â  font-size: 3cqw;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* --- Version Display Style --- */
Â  Â  Â  Â  .version-display {
Â  Â  Â  Â  Â  Â  font-size: 0.8em;
Â  Â  Â  Â  Â  Â  font-weight: normal;
Â  Â  Â  Â  Â  Â  opacity: 0.7;
Â  Â  Â  Â  Â  Â  padding-right: 5px;
Â  Â  Â  Â  Â  Â  user-select: none;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* --- Font Size Display --- */
Â  Â  Â  Â  #font-size-display { text-align: center; margin-top: 10px; }

Â  Â  Â  Â  /* --- Import/Export Styles --- */
Â  Â  Â  Â  #import-export-modal .window-body { display: flex; flex-wrap: wrap; justify-content: space-around; text-align: center; padding-top: 20px; padding-bottom: 10px; }
Â  Â  Â  Â  .io-section { width: 45%; margin-bottom: 10px; }
Â  Â  Â  Â  .io-section button { width: 80px; height: 60px; font-size: 2em; line-height: 1; }
Â  Â  Â  Â  .io-section p { margin-top: 5px; font-size: 0.9em; }
Â  Â  Â  Â  .io-warning { width: 100%; color: #888; font-size: 0.8em; text-align: center; margin-top: 15px; }

Â  Â  Â  Â  /* --- Dropdown Menu Styles --- */
Â  Â  Â  Â  .menu-item { position: relative; user-select: none; }
Â  Â  Â  Â  .dropdown-content { display: none; position: absolute; top: 100%; right: 0; background-color: #f9f9f9; min-width: 160px; box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2); z-index: 100; list-style: none; padding: 0; margin: 0; }
Â  Â  Â  Â  .menu-item:not(.menu-item-right) .dropdown-content { right: auto; left: 0; }
Â  Â  Â  Â  .dropdown-content li { padding: 8px 12px; cursor: pointer; color: black; border-bottom: 1px solid #ddd; }
Â  Â  Â  Â  .dropdown-content li:last-child { border-bottom: none; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* --- File Manager Styles --- */
Â  Â  Â  Â  #file-manager-window {Â 
Â  Â  Â  Â  Â  Â  position: fixed;Â 
Â  Â  Â  Â  Â  Â  top: 0;Â 
Â  Â  Â  Â  Â  Â  left: 0;Â 
Â  Â  Â  Â  Â  Â  z-index: 200;Â 
Â  Â  Â  Â  Â  Â  display: none;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  Â  Â  background-color: rgba(0,0,0,0.5);
Â  Â  Â  Â  }
Â  Â  Â  Â  #file-manager-content {Â 
Â  Â  Â  Â  Â  Â  display: flex;Â 
Â  Â  Â  Â  Â  Â  flex-grow: 1;Â 
Â  Â  Â  Â  Â  Â  min-height: 0;Â 
Â  Â  Â  Â  Â  Â  height: calc(100% - 30px);
Â  Â  Â  Â  }
Â  Â  Â  Â  #notes-list-container {Â 
Â  Â  Â  Â  Â  Â  width: 40%;Â 
Â  Â  Â  Â  Â  Â  display: flex;Â 
Â  Â  Â  Â  Â  Â  flex-direction: column;Â 
Â  Â  Â  Â  Â  Â  border-right: 1px solid;
Â  Â  Â  Â  Â  Â  overflow-y: auto;
Â  Â  Â  Â  }
Â  Â  Â  Â  .notes-list-header {Â 
Â  Â  Â  Â  Â  Â  display: flex;Â 
Â  Â  Â  Â  Â  Â  padding: 4px 8px;Â 
Â  Â  Â  Â  Â  Â  font-weight: bold;Â 
Â  Â  Â  Â  Â  Â  border-bottom: 1px solid;Â 
Â  Â  Â  Â  Â  Â  flex-shrink: 0;Â 
Â  Â  Â  Â  Â  Â  align-items: center;Â 
Â  Â  Â  Â  Â  Â  background-color: inherit;
Â  Â  Â  Â  }
Â  Â  Â  Â  .header-name { flex-grow: 1; }
Â  Â  Â  Â  #note-preview-container {Â 
Â  Â  Â  Â  Â  Â  width: 60%;Â 
Â  Â  Â  Â  Â  Â  display: flex;Â 
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  }
Â  Â  Â  Â  #note-preview-header {Â 
Â  Â  Â  Â  Â  Â  padding: 8px;Â 
Â  Â  Â  Â  Â  Â  border-bottom: 1px solid;Â 
Â  Â  Â  Â  Â  Â  flex-shrink: 0;Â 
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: space-between;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  background-color: inherit;
Â  Â  Â  Â  }
Â  Â  Â  Â  #note-preview-title { font-weight: bold; font-size: 1.2em; }
Â  Â  Â  Â  #note-preview-date { font-size: 0.9em; opacity: 0.8; }
Â  Â  Â  Â  #note-preview-actions { margin-top: 0; display: flex; gap: 8px; }
Â  Â  Â  Â  #note-preview-actions button, #filter-btn {
Â  Â  Â  Â  Â  Â  padding: 4px 10px;
Â  Â  Â  Â  Â  Â  font-size: 14px;
Â  Â  Â  Â  Â  Â  min-height: initial;
Â  Â  Â  Â  }
Â  Â  Â  Â  #note-preview {Â 
Â  Â  Â  Â  Â  Â  flex-grow: 1;Â 
Â  Â  Â  Â  Â  Â  padding: 10px;Â 
Â  Â  Â  Â  Â  Â  overflow-y: auto;Â 
Â  Â  Â  Â  Â  Â  white-space: pre-wrap;
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  }
Â  Â  Â  Â  .note-item {Â 
Â  Â  Â  Â  Â  Â  display: flex;Â 
Â  Â  Â  Â  Â  Â  align-items: flex-start;Â 
Â  Â  Â  Â  Â  Â  padding: 8px;Â 
Â  Â  Â  Â  Â  Â  cursor: pointer;Â 
Â  Â  Â  Â  Â  Â  border-bottom: 1px solid;Â 
Â  Â  Â  Â  Â  Â  gap: 8px;Â 
Â  Â  Â  Â  Â  Â  margin-bottom: 5px;
Â  Â  Â  Â  Â  Â  background-color: inherit;
Â  Â  Â  Â  }
Â  Â  Â  Â  .note-item .file-icon { width: 16px; height: 16px; flex-shrink: 0; margin-top: 2px; }
Â  Â  Â  Â  .note-item-details { flex-grow: 1; display: flex; flex-direction: column; }
Â  Â  Â  Â  .note-item-title { font-weight: bold; }
Â  Â  Â  Â  .note-item-date { font-size: 0.9em; opacity: 0.8; }
Â  Â  Â  Â  #notes-list {
Â  Â  Â  Â  Â  Â  overflow-y: auto;
Â  Â  Â  Â  Â  Â  flex-grow: 1;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* --- Unified Back Button --- */
Â  Â  Â  Â  #file-manager-back-btn {
Â  Â  Â  Â  Â  Â  display: none; /* Hidden by default */
Â  Â  Â  Â  Â  Â  background: none;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* --- Windows 95 Theme --- */
Â  Â  Â  Â  .theme-win95 body { background: #008080; }
Â  Â  Â  Â  .theme-win95 #app-window, .theme-win95 .modal-content, .theme-win95 #file-manager-window { background-color: #c0c0c0; border: 3px solid #c0c0c0; border-top-color: #ffffff; border-left-color: #ffffff; border-right-color: #000000; border-bottom-color: #000000; border-radius: 0; box-shadow: none; }
Â  Â  Â  Â  .theme-win95 .title-bar {Â 
Â  Â  Â  Â  Â  Â  background: linear-gradient(90deg, #000080, #1084d0);Â 
Â  Â  Â  Â  Â  Â  padding: 3px 5px;Â 
Â  Â  Â  Â  Â  Â  color: white;Â 
Â  Â  Â  Â  Â  Â  font-weight: bold;Â 
Â  Â  Â  Â  Â  Â  height: 20px;Â 
Â  Â  Â  Â  Â  Â  border-bottom: none;Â 
Â  Â  Â  Â  Â  Â  text-shadow: none;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .theme-win95 .title-bar-text { padding: 0 50px; }
Â  Â  Â  Â  .theme-win95 .menu-bar { display: flex; flex-wrap: wrap; justify-content: flex-end; list-style: none; margin: 0; padding: 2px; border-bottom: 1px solid #868a8e; background: #c0c0c0; gap: 0; }
Â  Â  Â  Â  .theme-win95 .menu-bar > li { padding: 2px 8px; font-size: 14px; border-radius: 0; border: none; background: none; box-shadow: none; color: black; }
Â  Â  Â  Â  .theme-win95 .menu-bar > li:hover { background: #000080; color: white; }
Â  Â  Â  Â  .theme-win95 .window-body { padding: 0; box-shadow: inset -1px -1px #fff, inset 1px 1px #000, inset -2px -2px #868a8e, inset 2px 2px #dfdfdf; }
Â  Â  Â  Â  .theme-win95 #editor, .theme-win95 #note-preview { background-color: white; border: none; font-family: 'Lucida Console', Courier, monospace; font-size: 16px; margin: 2px; scrollbar-color: #c0c0c0 #DFDFDF; scrollbar-width: auto; }
Â  Â  Â  Â  .theme-win95 ::-webkit-scrollbar { width: 16px; }
Â  Â  Â  Â  .theme-win95 ::-webkit-scrollbar-track { background: #DFDFDF; }
Â  Â  Â  Â  .theme-win95 ::-webkit-scrollbar-thumb { background-color: #c0c0c0; border: 2px outset #c0c0c0; }
Â  Â  Â  Â  .theme-win95 button, .theme-win95 select, .theme-win95 input[type="text"] { font-family: "Tahoma", sans-serif; font-size: 14px; border: 1px solid; border-color: #fff #000 #000 #fff; box-shadow: inset 1px 1px #dfdfdf, inset -1px -1px #868a8e; background-color: #c0c0c0; border-radius: 0; padding: 4px 15px; min-height: 23px; }
Â  Â  Â  Â  .theme-win95 button:active { border-color: #000 #fff #fff #000; box-shadow: inset -1px -1px #dfdfdf, inset 1px 1px #868a8e; }
Â  Â  Â  Â  .theme-win95 .win-button { width: 16px; height: 14px; min-width: 16px; padding: 0; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 12px; color: black; border-radius: 0; border: 1px solid; border-color: #fff #000 #000 #fff; background-color: #c0c0c0; }
Â  Â  Â  Â  .theme-win95 .win-button .icon { display: block; color: black; }
Â  Â  Â  Â  .theme-win95 .minimize-icon { border-bottom: 2px solid black; width: 6px; }
Â  Â  Â  Â  .theme-win95 .maximize-icon { width: 9px; height: 9px; border: 1px solid black; box-sizing: border-box; }
Â  Â  Â  Â  .theme-win95 .close-icon { font-family: 'Times New Roman', serif; line-height: 1; }
Â  Â  Â  Â  .theme-win95 .dropdown-content { border: 1px solid black; border-radius: 0; }
Â  Â  Â  Â  .theme-win95 .dropdown-content li { border-bottom: 1px solid #868a8e; }
Â  Â  Â  Â  .theme-win95 .dropdown-content li:hover { background: #000080; color: white; }
Â  Â  Â  Â  .theme-win95 #about-modal p { color: #222; }
Â  Â  Â  Â  .theme-win95 #notes-list-container, .theme-win95 .notes-list-header, .theme-win95 .note-item, .theme-win95 #note-preview-header { border-color: #868a8e; }
Â  Â  Â  Â  .theme-win95 .notes-list-header { border-top: 1px solid #fff; border-left: 1px solid #fff; }
Â  Â  Â  Â  .theme-win95 .note-item.active { background-color: #000080; color: white; }
Â  Â  Â  Â  .theme-win95 .note-item.active .file-icon { fill: white; }

Â  Â  Â  Â  /* Dark mode for Windows 95 */
Â  Â  Â  Â  .dark-mode.theme-win95 #about-modal p {
Â  Â  Â  Â  Â  Â  color: #e0e0e0 !important;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* --- Windows XP Theme --- */
Â  Â  Â  Â  .theme-winxp body { background: #D4D0C8; }
Â  Â  Â  Â  .theme-winxp #app-window, .theme-winxp .modal-content, .theme-winxp #file-manager-window { background-color: #ECE9D8; border: 1px solid #08246B; box-shadow: 0 0 10px rgba(0,0,0,0.5); border-radius: 6px; }
Â  Â  Â  Â  .theme-winxp .title-bar {Â 
Â  Â  Â  Â  Â  Â  background: linear-gradient(to bottom, #0058e1, #3d80f2 4%, #3d80f2 96%, #0058e1);Â 
Â  Â  Â  Â  Â  Â  padding: 3px 5px;Â 
Â  Â  Â  Â  Â  Â  color: white;Â 
Â  Â  Â  Â  Â  Â  font-weight: bold;Â 
Â  Â  Â  Â  Â  Â  height: 25px;Â 
Â  Â  Â  Â  Â  Â  border-bottom: 1px solid #08246B;Â 
Â  Â  Â  Â  Â  Â  font-size: 12px;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .theme-winxp .title-bar-text { padding: 0 60px; }
Â  Â  Â  Â  .theme-winxp .menu-bar { display: flex; flex-wrap: wrap; justify-content: flex-end; list-style: none; margin: 0; padding: 2px; background: #ECE9D8; border-bottom: 1px solid #ACA899; gap: 0; }
Â  Â  Â  Â  .theme-winxp .menu-bar > li { padding: 4px 8px; font-size: 11px; border: 1px solid transparent; border-radius: 0; background: none; box-shadow: none; color: black; }
Â  Â  Â  Â  .theme-winxp .menu-bar > li:hover { background: #316AC5; color: white; border: 1px solid #000; }
Â  Â  Â  Â  .theme-winxp .window-body { padding: 3px; box-shadow: none; }
Â  Â  Â  Â  .theme-winxp #editor, .theme-winxp #note-preview, .theme-winxp input, .theme-winxp select { border: 1px solid #7F9DB9; font-family: 'Lucida Console', Courier, monospace; font-size: 12px; margin: 0; scrollbar-color: #E0E0E0 #F5F5F5; scrollbar-width: auto; }
Â  Â  Â  Â  .theme-winxp ::-webkit-scrollbar { width: 17px; }
Â  Â  Â  Â  .theme-winxp ::-webkit-scrollbar-track { background: #F5F5F5; border-left: 1px solid #E0E0E0; }
Â  Â  Â  Â  .theme-winxp ::-webkit-scrollbar-thumb { background: linear-gradient(to right, #C2D5FC, #D5E1FC, #C2D5FC); border: 1px solid #7F9DB9; }
Â  Â  Â  Â  .theme-winxp button, .theme-winxp select, .theme-winxp input[type="text"] { font-family: "Tahoma", sans-serif; font-size: 11px; border: 1px solid #08246B; background: #ECE9D8; padding: 3px 12px; min-height: 23px; border-radius: 0; }
Â  Â  Â  Â  .theme-winxp button:hover, .theme-winxp select:hover { border-color: #f2c9d; background: #fdecae; }
Â  Â  Â  Â  .theme-winxp .win-button { width: 21px; height: 21px; min-width: 21px; padding: 0; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 14px; color: white; border-radius: 3px; border: 1px solid #08246B; }
Â  Â  Â  Â  .theme-winxp #close-btn { background: linear-gradient(to bottom, #fb7c6a, #e1523b); border-color: #94291a; }
Â  Â  Â  Â  .theme-winxp .win-button:not(#close-btn) { background: linear-gradient(to bottom, #6baff5, #3d83f2); border-color: #08246B; }
Â  Â  Â  Â  .theme-winxp .win-button .icon { display: block; color: white; }
Â  Â  Â  Â  .theme-winxp .minimize-icon { border-bottom: 2px solid white; width: 8px; }
Â  Â  Â  Â  .theme-winxp .maximize-icon { width: 9px; height: 9px; border: 2px solid white; border-top-width: 3px; box-sizing: border-box; }
Â  Â  Â  Â  .theme-winxp .close-icon { font-family: 'Arial Black', sans-serif; font-weight: 900; line-height: 1; }
Â  Â  Â  Â  .theme-winxp .dropdown-content { border: 1px solid #ACA899; border-radius: 0; }
Â  Â  Â  Â  .theme-winxp .dropdown-content li { border-bottom: 1px solid #ACA899; }
Â  Â  Â  Â  .theme-winxp .dropdown-content li:hover { background: #316AC5; color: white; }
Â  Â  Â  Â  .theme-winxp #about-modal p { color: #222; }
Â  Â  Â  Â  .theme-winxp #notes-list-container, .theme-winxp .notes-list-header, .theme-winxp .note-item, .theme-winxp #note-preview-header { border-color: #ACA899; }
Â  Â  Â  Â  .theme-winxp .note-item.active { background-color: #316AC5; color: white; }
Â  Â  Â  Â  .theme-winxp .note-item.active .file-icon { fill: white; }

Â  Â  Â  Â  /* Dark mode for Windows XP */
Â  Â  Â  Â  .dark-mode.theme-winxp #about-modal p {
Â  Â  Â  Â  Â  Â  color: #e0e0e0 !important;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* --- iOS Theme --- */
Â  Â  Â  Â  .theme-ios body { background: #f0f0f0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; }
Â  Â  Â  Â  .theme-ios #app-window, .theme-ios .modal-content, .theme-ios #file-manager-window { background-color: #ffffff; border: 1px solid #d1d1d6; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
Â  Â  Â  Â  .theme-ios .title-bar {Â 
Â  Â  Â  Â  Â  Â  background: #f7f7f7;Â 
Â  Â  Â  Â  Â  Â  padding: 10px;Â 
Â  Â  Â  Â  Â  Â  color: #000;Â 
Â  Â  Â  Â  Â  Â  font-weight: 600;Â 
Â  Â  Â  Â  Â  Â  height: auto;Â 
Â  Â  Â  Â  Â  Â  border-bottom: 1px solid #d1d1d6;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .theme-ios .title-bar-text {Â 
Â  Â  Â  Â  Â  Â  font-size: 17px;Â 
Â  Â  Â  Â  Â  Â  padding: 0 70px;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .theme-ios .menu-bar { display: flex; flex-wrap: wrap; justify-content: flex-end; list-style: none; margin: 0; padding: 8px; background: #f7f7f7; gap: 4px; border-bottom: 1px solid #d1d1d6; }
Â  Â  Â  Â  .theme-ios .menu-bar > li { padding: 5px 10px; font-size: 14px; font-weight: bold; border-radius: 8px; border: none; background: none; box-shadow: none; color: #007aff; cursor: pointer; }
Â  Â  Â  Â  .theme-ios .menu-bar > li:hover { background: #e5e5ea; }
Â  Â  Â  Â  .theme-ios .window-body { padding: 0; box-shadow: none; background-color: #fff; }
Â  Â  Â  Â  .theme-ios #editor, .theme-ios #note-preview { background-color: #fff; border: none; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; font-size: 17px; padding: 12px; line-height: 1.5; color: #000; }
Â  Â  Â  Â  .theme-ios ::-webkit-scrollbar { width: 8px; }
Â  Â  Â  Â  .theme-ios ::-webkit-scrollbar-track { background: transparent; }
Â  Â  Â  Â  .theme-ios ::-webkit-scrollbar-thumb { background-color: #c7c7cc; border-radius: 4px; }
Â  Â  Â  Â  .theme-ios button, .theme-ios select, .theme-ios input[type="text"] { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; font-size: 17px; border: 1px solid #d1d1d6; background-color: #fff; border-radius: 8px; padding: 8px 12px; min-height: 36px; }
Â  Â  Â  Â  .theme-ios button { background-color: #007aff; color: white; border: none; }
Â  Â  Â  Â  .theme-ios button:active { background-color: #005bb5; }
Â  Â  Â  Â  .theme-ios button.primary { background-color: #34c759; }
Â  Â  Â  Â  .theme-ios button.primary:active { background-color: #2ca049; }
Â  Â  Â  Â  .theme-ios .title-bar-controls { display: none; }
Â  Â  Â  Â  .theme-ios .dropdown-content { border: 1px solid #d1d1d6; border-radius: 8px; background-color: #fff; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
Â  Â  Â  Â  .theme-ios .dropdown-content li { color: #007aff; border-bottom: 1px solid #d1d1d6; }
Â  Â  Â  Â  .theme-ios .dropdown-content li:hover { background: #f0f0f0; color: #005bb5; }
Â  Â  Â  Â  .theme-ios #about-modal p { color: #222; }
Â  Â  Â  Â  .theme-ios #notes-list-container, .theme-ios .notes-list-header, .theme-ios .note-item, .theme-ios #note-preview-header { border-color: #d1d1d6; }
Â  Â  Â  Â  .theme-ios .note-item.active { background-color: #e5f1ff; color: #007aff; }
Â  Â  Â  Â  .theme-ios .note-item.active .file-icon { fill: #007aff; }
Â  Â  Â  Â  .theme-ios .file-icon { fill: #6c6c70; }
Â  Â  Â  Â  .theme-ios #file-manager-window .title-bar-controls { display: none; }
Â  Â  Â  Â  .theme-ios #file-manager-back-btn {Â 
Â  Â  Â  Â  Â  Â  display: block !important;
Â  Â  Â  Â  Â  Â  color: #007aff;
Â  Â  Â  Â  Â  Â  font-size: 17px;
Â  Â  Â  Â  Â  Â  font-weight: 400;
Â  Â  Â  Â  Â  Â  padding: 0 10px;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* --- Android Theme --- */
Â  Â  Â  Â  .theme-android body { background-color: #fafafa; font-family: 'Roboto', sans-serif; }
Â  Â  Â  Â  .theme-android #app-window, .theme-android .modal-content, .theme-android #file-manager-window { background-color: #ffffff; border: 1px solid #e0e0e0; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
Â  Â  Â  Â  .theme-android .title-bar {Â 
Â  Â  Â  Â  Â  Â  background: #ffffff;Â 
Â  Â  Â  Â  Â  Â  padding: 12px 16px;Â 
Â  Â  Â  Â  Â  Â  color: #202124;Â 
Â  Â  Â  Â  Â  Â  font-weight: 500;Â 
Â  Â  Â  Â  Â  Â  height: auto;Â 
Â  Â  Â  Â  Â  Â  border-bottom: 1px solid #e0e0e0;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .theme-android .title-bar-text {Â 
Â  Â  Â  Â  Â  Â  font-size: 18px;Â 
Â  Â  Â  Â  Â  Â  padding: 0 80px;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .theme-android #file-manager-window .title-bar-text {
Â  Â  Â  Â  Â  Â  left: 50px;
Â  Â  Â  Â  Â  Â  right: 50px;
Â  Â  Â  Â  Â  Â  padding: 0;
Â  Â  Â  Â  }
Â  Â  Â  Â  .theme-android .menu-bar { display: flex; flex-wrap: wrap; justify-content: flex-end; list-style: none; margin: 0; padding: 8px; background: #ffffff; gap: 4px; border-bottom: 1px solid #e0e0e0; }
Â  Â  Â  Â  .theme-android .menu-bar > li { padding: 6px 10px; font-size: 13px; border-radius: 20px; border: 1px solid #dadce0; background: #f1f3f4; box-shadow: none; color: #3c4043; cursor: pointer; }
Â  Â  Â  Â  .theme-android .menu-bar > li:hover { background: #e8eaed; }
Â  Â  Â  Â  .theme-android .window-body { padding: 0; box-shadow: none; background-color: #fff; }
Â  Â  Â  Â  .theme-android #editor, .theme-android #note-preview { background-color: #fff; border: none; font-family: 'Roboto', sans-serif; font-size: 16px; padding: 16px; line-height: 1.6; color: #202124; }
Â  Â  Â  Â  .theme-android ::-webkit-scrollbar { width: 8px; }
Â  Â  Â  Â  .theme-android ::-webkit-scrollbar-track { background: transparent; }
Â  Â  Â  Â  .theme-android ::-webkit-scrollbar-thumb { background-color: #dadce0; border-radius: 4px; }
Â  Â  Â  Â  .theme-android button, .theme-android select, .theme-android input[type="text"] { font-family: 'Roboto', sans-serif; font-size: 14px; border: 1px solid #dadce0; background-color: #f1f3f4; border-radius: 8px; padding: 10px 14px; min-height: 40px; }
Â  Â  Â  Â  .theme-android button { background-color: #1a73e8; color: white; border: none; font-weight: 500; }
Â  Â  Â  Â  .theme-android button:active { background-color: #185abc; }
Â  Â  Â  Â  .theme-android button.primary { background-color: #1a73e8; }
Â  Â  Â  Â  .theme-android button.primary:active { background-color: #185abc; }
Â  Â  Â  Â  .theme-android .title-bar-controls { display: none; }
Â  Â  Â  Â  .theme-android .dropdown-content { border: 1px solid #e0e0e0; border-radius: 8px; background-color: #fff; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
Â  Â  Â  Â  .theme-android .dropdown-content li { color: #3c4043; border-bottom: 1px solid #e0e0e0; }
Â  Â  Â  Â  .theme-android .dropdown-content li:hover { background: #f1f3f4; }
Â  Â  Â  Â  .theme-android #about-modal p { color: #222; }
Â  Â  Â  Â  .theme-android #notes-list-container, .theme-android .notes-list-header, .theme-android .note-item, .theme-android #note-preview-header { border-color: #e0e0e0; }
Â  Â  Â  Â  .theme-android .notes-list-header { background-color: #f8f9fa; }
Â  Â  Â  Â  .theme-android .note-item.active { background-color: #e8f0fe; }
Â  Â  Â  Â  .theme-android .note-item.active .file-icon { fill: #1a73e8; }
Â  Â  Â  Â  .theme-android .file-icon { fill: #5f6368; }
Â  Â  Â  Â  .theme-android #file-manager-window .title-bar { justify-content: flex-start; gap: 8px; }
Â  Â  Â  Â  .theme-android #file-manager-window .title-bar-controls { display: none; }
Â  Â  Â  Â  /* Android Back Button Styling */
Â  Â  Â  Â  .theme-android #file-manager-back-btn {
Â  Â  Â  Â  Â  Â  display: flex !important;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  padding: 8px 16px;
Â  Â  Â  Â  Â  Â  margin-right: 8px;
Â  Â  Â  Â  Â  Â  border-radius: 20px;
Â  Â  Â  Â  Â  Â  background-color: #1a73e8;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  font-weight: 500;
Â  Â  Â  Â  Â  Â  font-size: 14px;
Â  Â  Â  Â  Â  Â  text-transform: uppercase;
Â  Â  Â  Â  Â  Â  box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
Â  Â  Â  Â  Â  Â  transition: all 0.3s cubic-bezier(.25,.8,.25,1);
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  Â  Â  z-index: 2;
Â  Â  Â  Â  }
Â  Â  Â  Â  .theme-android #file-manager-back-btn:hover {
Â  Â  Â  Â  Â  Â  background-color: #185abc;
Â  Â  Â  Â  Â  Â  box-shadow: 0 3px 6px rgba(0,0,0,0.16), 0 3px 6px rgba(0,0,0,0.23);
Â  Â  Â  Â  }
Â  Â  Â  Â  .theme-android #file-manager-back-btn svg {
Â  Â  Â  Â  Â  Â  width: 20px;
Â  Â  Â  Â  Â  Â  height: 20px;
Â  Â  Â  Â  Â  Â  margin-right: 8px;
Â  Â  Â  Â  Â  Â  fill: white;
Â  Â  Â  Â  }
Â  Â  Â  Â  /* Dark mode adjustments */
Â  Â  Â  Â  .dark-mode.theme-android #file-manager-back-btn {
Â  Â  Â  Â  Â  Â  background-color: #8ab4f8;
Â  Â  Â  Â  Â  Â  color: #202124;
Â  Â  Â  Â  }
Â  Â  Â  Â  .dark-mode.theme-android #file-manager-back-btn:hover {
Â  Â  Â  Â  Â  Â  background-color: #7aa3e6;
Â  Â  Â  Â  }
Â  Â  Â  Â  .dark-mode.theme-android #file-manager-back-btn svg {
Â  Â  Â  Â  Â  Â  fill: #202124;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* --- Dark Mode Overrides --- */
Â  Â  Â  Â  body.dark-mode { background-color: #121212; }
Â  Â  Â  Â  .dark-mode #app-window, .dark-mode .modal-content, .dark-mode #file-manager-window, .dark-mode .dropdown-content { background-color: #1e1e1e; color: #e0e0e0; }
Â  Â  Â  Â  .dark-mode #font-size-modal .modal-content { background-color: #1e1e1e; }
Â  Â  Â  Â  .dark-mode .title-bar { background: #2c2c2c; color: #e0e0e0; border-bottom-color: #3c3c3c; }
Â  Â  Â  Â  .dark-mode .menu-bar { background: #2c2c2c; border-bottom-color: #3c3c3c; }
Â  Â  Â  Â  .dark-mode .menu-bar > li { background: #3c3c3c; color: #e0e0e0; border-color: #555; }
Â  Â  Â  Â  .dark-mode .menu-bar > li:hover { background: #555; }
Â  Â  Â  Â  .dark-mode #editor, .dark-mode #note-preview, .dark-mode input, .dark-mode select { background-color: #2c2c2c; color: #e0e0e0; border-color: #555; }
Â  Â  Â  Â  .dark-mode button { background-color: #007aff; color: #fff; }
Â  Â  Â  Â  .dark-mode button:active { background-color: #005bb5; }
Â  Â  Â  Â  .dark-mode .dropdown-content li { color: #e0e0e0; border-bottom-color: #3c3c3c; }
Â  Â  Â  Â  .dark-mode .dropdown-content li:hover { background: #3c3c3c; }
Â  Â  Â  Â  .dark-mode .note-item { border-bottom-color: #3c3c3c; }
Â  Â  Â  Â  .dark-mode .note-item.active { background-color: #007aff; color: #fff; }
Â  Â  Â  Â  .dark-mode .file-icon { fill: #e0e0e0; }
Â  Â  Â  Â  .dark-mode .note-item.active .file-icon { fill: #fff; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* Dark mode for iOS - Fixed popup backgrounds */
Â  Â  Â  Â  .dark-mode.theme-ios #app-window,Â 
Â  Â  Â  Â  .dark-mode.theme-ios .modal-content,Â 
Â  Â  Â  Â  .dark-mode.theme-ios #file-manager-window {Â 
Â  Â  Â  Â  Â  Â  background-color: #1c1c1e;Â 
Â  Â  Â  Â  Â  Â  border-color: #333;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .dark-mode.theme-ios .modal-content .window-body,
Â  Â  Â  Â  .dark-mode.theme-ios #file-manager-window .window-body {
Â  Â  Â  Â  Â  Â  background-color: #1c1c1e !important;
Â  Â  Â  Â  }
Â  Â  Â  Â  .dark-mode.theme-ios .title-bar,Â 
Â  Â  Â  Â  .dark-mode.theme-ios .menu-bar {Â 
Â  Â  Â  Â  Â  Â  background: #1c1c1e;Â 
Â  Â  Â  Â  Â  Â  border-bottom-color: #333;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .dark-mode.theme-ios .title-bar-text,Â 
Â  Â  Â  Â  .dark-mode.theme-ios p {Â 
Â  Â  Â  Â  Â  Â  color: #fff;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .dark-mode.theme-ios .menu-bar > li {Â 
Â  Â  Â  Â  Â  Â  color: #0a84ff;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .dark-mode.theme-ios .menu-bar > li:hover {Â 
Â  Â  Â  Â  Â  Â  background: #2c2c2e;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .dark-mode.theme-ios #editor,Â 
Â  Â  Â  Â  .dark-mode.theme-ios #note-preview,Â 
Â  Â  Â  Â  .dark-mode.theme-ios input,Â 
Â  Â  Â  Â  .dark-mode.theme-ios select {Â 
Â  Â  Â  Â  Â  Â  background-color: #1c1c1e;Â 
Â  Â  Â  Â  Â  Â  color: #fff;Â 
Â  Â  Â  Â  Â  Â  border-color: #333;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .dark-mode.theme-ios .dropdown-content {Â 
Â  Â  Â  Â  Â  Â  background-color: #1c1c1e !important;
Â  Â  Â  Â  Â  Â  border-color: #333 !important;
Â  Â  Â  Â  }
Â  Â  Â  Â  .dark-mode.theme-ios .dropdown-content li {Â 
Â  Â  Â  Â  Â  Â  color: #0a84ff;Â 
Â  Â  Â  Â  Â  Â  border-bottom-color: #333;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .dark-mode.theme-ios .dropdown-content li:hover {Â 
Â  Â  Â  Â  Â  Â  background: #2c2c2e;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .dark-mode.theme-ios #about-modal p {Â 
Â  Â  Â  Â  Â  Â  color: #fff;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .dark-mode.theme-ios #font-size-modal .modal-content {Â 
Â  Â  Â  Â  Â  Â  background-color: #1c1c1e;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .dark-mode.theme-ios #file-manager-window .window-body {Â 
Â  Â  Â  Â  Â  Â  background-color: #1c1c1e;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .dark-mode.theme-ios .note-item.active {Â 
Â  Â  Â  Â  Â  Â  background-color: #0a84ff;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .dark-mode.theme-ios .notes-list-header {
Â  Â  Â  Â  Â  Â  background-color: #1c1c1e;
Â  Â  Â  Â  Â  Â  border-color: #333;
Â  Â  Â  Â  }
Â  Â  Â  Â  .dark-mode.theme-ios #notes-list-container {
Â  Â  Â  Â  Â  Â  background-color: #1c1c1e;
Â  Â  Â  Â  }
Â  Â  Â  Â  .dark-mode.theme-ios button {
Â  Â  Â  Â  Â  Â  background-color: #0a84ff;
Â  Â  Â  Â  }
Â  Â  Â  Â  .dark-mode.theme-ios button.primary {
Â  Â  Â  Â  Â  Â  background-color: #30d158;
Â  Â  Â  Â  }
Â  Â  Â  Â  .dark-mode.theme-ios input[type="text"],
Â  Â  Â  Â  .dark-mode.theme-ios select {
Â  Â  Â  Â  Â  Â  background-color: #2c2c2c !important;
Â  Â  Â  Â  Â  Â  color: #fff !important;
Â  Â  Â  Â  Â  Â  border-color: #444 !important;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Dark mode for Android - Fixed popup backgrounds */
Â  Â  Â  Â  .dark-mode.theme-android body {Â 
Â  Â  Â  Â  Â  Â  background-color: #121212;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .dark-mode.theme-android #app-window,Â 
Â  Â  Â  Â  .dark-mode.theme-android .modal-content,Â 
Â  Â  Â  Â  .dark-mode.theme-android #file-manager-window {Â 
Â  Â  Â  Â  Â  Â  background-color: #1e1e1e;Â 
Â  Â  Â  Â  Â  Â  border-color: #333;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .dark-mode.theme-android .modal-content .window-body,
Â  Â  Â  Â  .dark-mode.theme-android #file-manager-window .window-body {
Â  Â  Â  Â  Â  Â  background-color: #1e1e1e !important;
Â  Â  Â  Â  }
Â  Â  Â  Â  .dark-mode.theme-android .title-bar,Â 
Â  Â  Â  Â  .dark-mode.theme-android .menu-bar {Â 
Â  Â  Â  Â  Â  Â  background: #2c2c2c;Â 
Â  Â  Â  Â  Â  Â  border-bottom-color: #333;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .dark-mode.theme-android .title-bar-text,Â 
Â  Â  Â  Â  .dark-mode.theme-android p {Â 
Â  Â  Â  Â  Â  Â  color: #e0e0e0;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .dark-mode.theme-android .menu-bar > li {Â 
Â  Â  Â  Â  Â  Â  background: #3c3c3c;Â 
Â  Â  Â  Â  Â  Â  color: #e0e0e0;Â 
Â  Â  Â  Â  Â  Â  border-color: #555;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .dark-mode.theme-android .menu-bar > li:hover {Â 
Â  Â  Â  Â  Â  Â  background: #555;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .dark-mode.theme-android .dropdown-content {Â 
Â  Â  Â  Â  Â  Â  background-color: #1e1e1e !important;
Â  Â  Â  Â  Â  Â  border-color: #333 !important;
Â  Â  Â  Â  }
Â  Â  Â  Â  .dark-mode.theme-android .dropdown-content li {Â 
Â  Â  Â  Â  Â  Â  color: #e0e0e0;Â 
Â  Â  Â  Â  Â  Â  border-bottom-color: #333;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .dark-mode.theme-android .dropdown-content li:hover {Â 
Â  Â  Â  Â  Â  Â  background: #3c3c3c;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .dark-mode.theme-android #about-modal p {Â 
Â  Â  Â  Â  Â  Â  color: #fff;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .dark-mode.theme-android #font-size-modal .modal-content {Â 
Â  Â  Â  Â  Â  Â  background-color: #1e1e1e;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .dark-mode.theme-android #file-manager-window .window-body {Â 
Â  Â  Â  Â  Â  Â  background-color: #1e1e1e;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .dark-mode.theme-android .note-item.active {Â 
Â  Â  Â  Â  Â  Â  background-color: #8ab4f8;Â 
Â  Â  Â  Â  Â  Â  color: #202124;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .dark-mode.theme-android .note-item.active .file-icon {Â 
Â  Â  Â  Â  Â  Â  fill: #202124;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .dark-mode.theme-android .notes-list-header {
Â  Â  Â  Â  Â  Â  background-color: #2c2c2c;
Â  Â  Â  Â  Â  Â  border-color: #333;
Â  Â  Â  Â  }
Â  Â  Â  Â  .dark-mode.theme-android #notes-list-container {
Â  Â  Â  Â  Â  Â  background-color: #2c2c2c;
Â  Â  Â  Â  }
Â  Â  Â  Â  .dark-mode.theme-android button {
Â  Â  Â  Â  Â  Â  background-color: #8ab4f8;
Â  Â  Â  Â  Â  Â  color: #202124;
Â  Â  Â  Â  }
Â  Â  Â  Â  .dark-mode.theme-android button.primary {
Â  Â  Â  Â  Â  Â  background-color: #81c995;
Â  Â  Â  Â  }
Â  Â  Â  Â  .dark-mode.theme-android input[type="text"],
Â  Â  Â  Â  .dark-mode.theme-android select {
Â  Â  Â  Â  Â  Â  background-color: #2c2c2c !important;
Â  Â  Â  Â  Â  Â  color: #fff !important;
Â  Â  Â  Â  Â  Â  border-color: #444 !important;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* --- FIX: Dark Mode Input Boxes --- */
Â  Â  Â  Â  .dark-mode.theme-win95 input[type="text"],
Â  Â  Â  Â  .dark-mode.theme-win95 select,
Â  Â  Â  Â  .dark-mode.theme-winxp input[type="text"],
Â  Â  Â  Â  .dark-mode.theme-winxp select {
Â  Â  Â  Â  Â  Â  background-color: #2c2c2c;
Â  Â  Â  Â  Â  Â  color: #e0e0e0;
Â  Â  Â  Â  Â  Â  border: 1px solid #555;
Â  Â  Â  Â  Â  Â  box-shadow: none;
Â  Â  Â  Â  Â  Â  background-image: none;
Â  Â  Â  Â  }
Â  Â  </style>

</head>
<body class="theme-android">
<div id="app-window">
Â  Â  <div class="title-bar">
Â  Â  Â  Â  <div class="title-bar-text">AFSNote</div>
Â  Â  Â  Â  <div class="title-bar-controls">
Â  Â  Â  Â  Â  Â  <button id="minimize-btn" class="win-button" aria-label="Minimize"><span class="icon minimize-icon"></span></button>
Â  Â  Â  Â  Â  Â  <button id="maximize-btn" class="win-button" aria-label="Maximize"><span class="icon maximize-icon"></span></button>
Â  Â  Â  Â  Â  Â  <button id="close-btn" class="win-button" aria-label="Close"><span class="icon close-icon">Ã—</span></button>
Â  Â  Â  Â  </div>
Â  Â  </div>
Â  Â  <ul class="menu-bar">
Â  Â  Â  Â  <li class="menu-item">
Â  Â  Â  Â  Â  Â  File
Â  Â  Â  Â  Â  Â  <ul class="dropdown-content">
Â  Â  Â  Â  Â  Â  Â  Â  <li id="new-file-btn">New Note</li>
Â  Â  Â  Â  Â  Â  Â  Â  <li id="open-file-btn">Open from Device...</li>
Â  Â  Â  Â  Â  Â  Â  Â  <li id="save-note-btn">Save Note</li>
Â  Â  Â  Â  Â  Â  Â  Â  <li id="save-to-device-btn">Save to Device...</li>
Â  Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  </li>
Â  Â  Â  Â  <li id="saved-notes-btn">Saved Notes</li>
Â  Â  Â  Â  <li class="menu-item menu-item-right">
Â  Â  Â  Â  Â  Â  Styles
Â  Â  Â  Â  Â  Â  <ul class="dropdown-content">
Â  Â  Â  Â  Â  Â  Â  Â  <li id="theme-win95-btn">Windows 95</li>
Â  Â  Â  Â  Â  Â  Â  Â  <li id="theme-winxp-btn">Windows XP</li>
Â  Â  Â  Â  Â  Â  Â  Â  <li id="theme-ios-btn">iOS</li>
Â  Â  Â  Â  Â  Â  Â  Â  <li id="theme-android-btn">Android</li>
Â  Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  </li>
Â  Â  Â  Â  <li class="menu-item menu-item-right">
Â  Â  Â  Â  Â  Â  Tools
Â  Â  Â  Â  Â  Â  <ul class="dropdown-content">
Â  Â  Â  Â  Â  Â  Â  Â  <li id="font-size-menu-btn">Font Size</li>
Â  Â  Â  Â  Â  Â  Â  Â  <li id="replace-menu-btn">Replace</li>
Â  Â  Â  Â  Â  Â  Â  Â  <li id="import-export-btn">Import/Export</li>
Â  Â  Â  Â  Â  Â  Â  Â  <li id="dark-mode-toggle">Light Mode</li>
Â  Â  Â  Â  Â  Â  Â  Â  <li id="about-menu-btn">About</li>
Â  Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  </li>
Â  Â  </ul>
Â  Â  <div class="window-body">
Â  Â  Â  Â  <textarea id="editor" spellcheck="false"></textarea>
Â  Â  </div>
</div>

<div id="about-modal" class="modal">
Â  Â  <div class="modal-content">
Â  Â  Â  Â  <div class="title-bar">
Â  Â  Â  Â  Â  Â  <div class="title-bar-text">About AFSNote</div>
Â  Â  Â  Â  Â  Â  <div class="version-display">[Version 1.0.0]</div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="window-body">
Â  Â  Â  Â  Â  Â  <p style="text-align: center; margin: 20px; font-weight: bold;">
Â  Â  Â  Â  Â  Â  Â  Â  This shitty app was vibe coded by <br>an absolute complete dumbass
Â  Â  Â  Â  Â  Â  Â  Â  who was sick <br>of all your shitty note apps.
Â  Â  Â  Â  Â  Â  Â  Â  <br><br>
Â  Â  Â  Â  Â  Â  Â  Â  Like who the fuck wants a note taking app <br>to open DIRECTLY
Â  Â  Â  Â  Â  Â  Â  Â  to the saved notes, <br>showing you every single note <br>with just
Â  Â  Â  Â  Â  Â  Â  Â  enough of a snippet to raise suspicion, <br>get better you fucking weirdos.
Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  <p style="text-align: center; margin: 20px; font-weight: bold;">
Â  Â  Â  Â  Â  Â  Â  Â  Your notes are stored locally in your browser,<br>
Â  Â  Â  Â  Â  Â  Â  Â  so it's your fault if you lose them, dumbass.
Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  <section class="field-row"><button id="close-modal-1">Close</button></section>
Â  Â  Â  Â  </div>
Â  Â  </div>
</div>

<div id="save-note-modal" class="modal">
Â  Â  Â <div class="modal-content">
Â  Â  Â  Â  <div class="title-bar"><div class="title-bar-text">Save Note</div></div>
Â  Â  Â  Â  <div class="window-body">
Â  Â  Â  Â  Â  Â  <label for="note-name-input" style="display: block; margin-bottom: 8px;">Note Name:</label>
Â  Â  Â  Â  Â  Â  <input type="text" id="note-name-input" value="">
Â  Â  Â  Â  Â  Â  <section class="field-row"><button id="cancel-note-save-btn">Cancel</button><button id="confirm-note-save-btn" class="primary">Save</button></section>
Â  Â  Â  Â  </div>
Â  Â  </div>
</div>

<div id="save-to-device-modal" class="modal">
Â  Â  Â <div class="modal-content">
Â  Â  Â  Â  <div class="title-bar"><div class="title-bar-text">Save to Device</div></div>
Â  Â  Â  Â  <div class="window-body">
Â  Â  Â  Â  Â  Â  <label for="device-filename-input" style="display: block; margin-bottom: 8px;">File Name:</label>
Â  Â  Â  Â  Â  Â  <input type="text" id="device-filename-input" value="" placeholder="filename.txt">
Â  Â  Â  Â  Â  Â  <label for="file-type-select" style="display: block; margin-top: 10px; margin-bottom: 8px;">File Type:</label>
Â  Â  Â  Â  Â  Â  <select id="file-type-select">
Â  Â  Â  Â  Â  Â  Â  Â  <option value="txt">.txt (Text File)</option>
Â  Â  Â  Â  Â  Â  Â  Â  <option value="html">.html (HTML File)</option>
Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  <section class="field-row"><button id="cancel-device-save-btn">Cancel</button><button id="confirm-device-save-btn" class="primary">Save</button></section>
Â  Â  Â  Â  </div>
Â  Â  </div>
</div>

<div id="font-size-modal" class="modal">
Â  Â  Â <div class="modal-content">
Â  Â  Â  Â <div class="title-bar"><div class="title-bar-text">Adjust Font Size</div></div>
Â  Â  Â  Â <div class="window-body">
Â  Â  Â  Â  Â  Â <input type="range" id="font-size-slider" min="8" max="48" value="16">
Â  Â  Â  Â  Â  Â <p id="font-size-display">16px</p>
Â  Â  Â  Â  Â  Â <section class="field-row"><button id="close-font-modal-btn">Close</button></section>
Â  Â  Â  Â </div>
Â  Â </div>
</div>

<div id="replace-modal" class="modal">
Â  Â  <div class="modal-content">
Â  Â  Â  Â  <div class="title-bar"><div class="title-bar-text">Replace</div></div>
Â  Â  Â  Â  <div class="window-body">
Â  Â  Â  Â  Â  Â  <label for="find-input">Find:</label>
Â  Â  Â  Â  Â  Â  <input type="text" id="find-input">
Â  Â  Â  Â  Â  Â  <label for="replace-input" style="margin-top: 10px;">Replace with:</label>
Â  Â  Â  Â  Â  Â  <input type="text" id="replace-input">
Â  Â  Â  Â  Â  Â  <section class="field-row">
Â  Â  Â  Â  Â  Â  Â  Â  <button id="confirm-replace-all-btn">Replace All</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button id="close-replace-btn">Close</button>
Â  Â  Â  Â  Â  Â  </section>
Â  Â  Â  Â  </div>
Â  Â  </div>
</div>

<div id="import-export-modal" class="modal">
Â  Â  <div class="modal-content">
Â  Â  Â  Â  <div class="title-bar"><div class="title-bar-text">Import/Export Notes</div></div>
Â  Â  Â  Â  <div class="window-body">
Â  Â  Â  Â  Â  Â  <div class="io-section">
Â  Â  Â  Â  Â  Â  Â  Â  <button id="import-notes-btn">ðŸ“¥</button>
Â  Â  Â  Â  Â  Â  Â  Â  <p>Import Notes</p>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="io-section">
Â  Â  Â  Â  Â  Â  Â  Â  <button id="export-notes-btn">ðŸ“¤</button>
Â  Â  Â  Â  Â  Â  Â  Â  <p>Export Notes</p>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <p class="io-warning">Note: Your notes are stored locally in your browser.</p>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <section class="field-row">
Â  Â  Â  Â  Â  Â  <button id="close-io-modal-btn">Close</button>
Â  Â  Â  Â  </section>
Â  Â  </div>
</div>

<div id="delete-confirm-modal" class="modal">
Â  Â  <div class="modal-content">
Â  Â  Â  Â  <div class="title-bar"><div class="title-bar-text">Confirm Deletion</div></div>
Â  Â  Â  Â  <div class="window-body">
Â  Â  Â  Â  Â  Â  <p style="text-align: center; margin: 20px;">Are you sure you want to delete this note?</p>
Â  Â  Â  Â  Â  Â  <section class="field-row">
Â  Â  Â  Â  Â  Â  Â  Â  <button id="cancel-delete-btn">No</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button id="confirm-delete-btn" class="primary">Yes</button>
Â  Â  Â  Â  Â  Â  </section>
Â  Â  Â  Â  </div>
Â  Â  </div>
</div>

<input type="file" id="file-opener" accept=".txt,text/plain">
<input type="file" id="import-file-opener" accept=".json,application/json">

<div id="file-manager-window">
Â  Â  <div class="title-bar">
Â  Â  Â  Â  <button id="file-manager-back-btn">
Â  Â  Â  Â  Â  Â  <svg viewBox="0 0 24 24" width="20" height="20">
Â  Â  Â  Â  Â  Â  Â  Â  <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
Â  Â  Â  Â  Â  Â  </svg>
Â  Â  Â  Â  Â  Â  Back
Â  Â  Â  Â  </button>
Â  Â  Â  Â  <div class="title-bar-text">Saved Notes</div>
Â  Â  Â  Â  <div class="title-bar-controls">
Â  Â  Â  Â  Â  Â  <button id="file-manager-close-btn" class="win-button" aria-label="Close"><span class="icon close-icon">Ã—</span></button>
Â  Â  Â  Â  </div>
Â  Â  </div>
Â  Â  <div class="window-body">
Â  Â  Â  Â  Â <div id="file-manager-content">
Â  Â  Â  Â  Â  Â  <div id="notes-list-container">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="notes-list-header">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="header-name">Name</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="menu-item">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="filter-btn">Filter</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <ul class="dropdown-content">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li data-sort="name-asc">Name (A-Z)</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li data-sort="name-desc">Name (Z-A)</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li data-sort="date-desc">Newest First</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li data-sort="date-asc">Oldest First</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="notes-list"></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div id="note-preview-container">
Â  Â  Â  Â  Â  Â  Â  Â  <div id="note-preview-header">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="note-preview-title"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="note-preview-date"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="note-preview-actions">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="preview-open-btn">Open in Editor</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="preview-delete-btn">Delete</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="note-preview">Select a note to preview...</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>
</div>

<script>
Â  Â  document.addEventListener('DOMContentLoaded', () => {
Â  Â  Â  Â  const getEl = id => document.getElementById(id);
Â  Â  Â  Â  // --- State ---
Â  Â  Â  Â  let currentNoteId = null;
Â  Â  Â  Â  let selectedPreviewId = null;
Â  Â  Â  Â  let isDirty = false; // Flag for unsaved changes
Â  Â  Â  Â  let autosaveTimeout = null; // Timer for autosave
Â  Â  Â  Â  // --- Element Cache ---
Â  Â  Â  Â  const editor = getEl('editor');
Â  Â  Â  Â  const fileOpener = getEl('file-opener');
Â  Â  Â  Â  const importFileOpener = getEl('import-file-opener');
Â  Â  Â  Â  const closeBtn = getEl('close-btn');
Â  Â  Â  Â  const titleBarText = document.querySelector('#app-window .title-bar-text');
Â  Â  Â  Â  // Menu Buttons
Â  Â  Â  Â  const newFileBtn = getEl('new-file-btn');
Â  Â  Â  Â  const openFileBtn = getEl('open-file-btn');
Â  Â  Â  Â  const saveNoteBtn = getEl('save-note-btn');
Â  Â  Â  Â  const saveToDeviceBtn = getEl('save-to-device-btn');
Â  Â  Â  Â  const aboutMenuBtn = getEl('about-menu-btn');
Â  Â  Â  Â  const fontSizeMenuBtn = getEl('font-size-menu-btn');
Â  Â  Â  Â  const savedNotesBtn = getEl('saved-notes-btn');
Â  Â  Â  Â  const replaceMenuBtn = getEl('replace-menu-btn');
Â  Â  Â  Â  const importExportBtn = getEl('import-export-btn');
Â  Â  Â  Â  const darkModeToggle = getEl('dark-mode-toggle');
Â  Â  Â  Â  const fontSizeSlider = getEl('font-size-slider');
Â  Â  Â  Â  const fontSizeDisplay = getEl('font-size-display');
Â  Â  Â  Â  const fileTypeSelect = getEl('file-type-select');
Â  Â  Â  Â  const deviceFilenameInput = getEl('device-filename-input');
Â  Â  Â  Â Â 
        // --- Title Bar Logic ---
        const updateTitleBar = (noteName, showSavedMessage = false) => {
            let displayName = noteName || 'Untitled';
            if (displayName.length > 15) {
                displayName = displayName.substring(0, 15) + '...';
            }
            const baseTitle = `${displayName} - AFSNote`;
            titleBarText.textContent = baseTitle;
            if (showSavedMessage) {
                titleBarText.textContent = `âœ“ Saved - ${displayName} - AFSNote`;
                setTimeout(() => {
                    if (titleBarText.textContent.startsWith('âœ“ Saved')) {
                        titleBarText.textContent = baseTitle;
                    }
                }, 1500);
            }
        };

Â  Â  Â  Â  // --- Theme Switcher Logic ---
Â  Â  Â  Â  const closeAllDropdowns = () => {
Â  Â  Â  Â  Â  Â  document.querySelectorAll('.dropdown-content').forEach(d => d.style.display = 'none');
Â  Â  Â  Â  };

Â  Â  Â  Â  document.querySelectorAll('.menu-item').forEach(item => {
Â  Â  Â  Â  Â  Â  const hasDropdown = item.querySelector('.dropdown-content');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  item.addEventListener('click', event => {
Â  Â  Â  Â  Â  Â  Â  Â  if (hasDropdown && event.target.closest('.dropdown-content')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  event.stopPropagation();
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (hasDropdown) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const dropdown = item.querySelector('.dropdown-content');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isVisible = dropdown.style.display === 'block';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  closeAllDropdowns();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!isVisible) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dropdown.style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  closeAllDropdowns();
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  });
Â  Â  Â  Â  document.querySelectorAll('.dropdown-content li').forEach(item => {
Â  Â  Â  Â  Â  Â  item.addEventListener('click', closeAllDropdowns);
Â  Â  Â  Â  });
Â  Â  Â  Â  window.addEventListener('click', closeAllDropdowns);
Â  Â  Â  Â Â 
Â  Â  Â  Â  const setTheme = (theme) => {
Â  Â  Â  Â  Â  Â  const isDark = document.body.classList.contains('dark-mode');
Â  Â  Â  Â  Â  Â  document.body.className = isDark ? `dark-mode ${theme}` : theme;
Â  Â  Â  Â  Â  Â  localStorage.setItem('afsnote_theme', theme);
Â  Â  Â  Â  };

Â  Â  Â  Â  getEl('theme-win95-btn').addEventListener('click', () => setTheme('theme-win95'));
Â  Â  Â  Â  getEl('theme-winxp-btn').addEventListener('click', () => setTheme('theme-winxp'));
Â  Â  Â  Â  getEl('theme-ios-btn').addEventListener('click', () => setTheme('theme-ios'));
Â  Â  Â  Â  getEl('theme-android-btn').addEventListener('click', () => setTheme('theme-android'));
Â  Â  Â  Â  const savedTheme = localStorage.getItem('afsnote_theme') || 'theme-android';
Â  Â  Â  Â  setTheme(savedTheme);

Â  Â  Â  Â  // --- Dark Mode Logic ---
Â  Â  Â  Â  const setDarkMode = (isDark) => {
Â  Â  Â  Â  Â  Â  const currentTheme = localStorage.getItem('afsnote_theme') || 'theme-android';
Â  Â  Â  Â  Â  Â  if (isDark) {
Â  Â  Â  Â  Â  Â  Â  Â  document.body.classList.add('dark-mode');
Â  Â  Â  Â  Â  Â  Â  Â  darkModeToggle.textContent = 'Dark Mode';
Â  Â  Â  Â  Â  Â  Â  Â  localStorage.setItem('afsnote_darkmode', 'enabled');
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  document.body.classList.remove('dark-mode');
Â  Â  Â  Â  Â  Â  Â  Â  darkModeToggle.textContent = 'Light Mode';
Â  Â  Â  Â  Â  Â  Â  Â  localStorage.setItem('afsnote_darkmode', 'disabled');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â setTheme(currentTheme);
Â  Â  Â  Â  };

Â  Â  Â  Â  darkModeToggle.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  setDarkMode(!document.body.classList.contains('dark-mode'));
Â  Â  Â  Â  });
Â  Â  Â  Â  const savedDarkMode = localStorage.getItem('afsnote_darkmode');
Â  Â  Â  Â  const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
Â  Â  Â  Â  if (savedDarkMode === 'enabled' || (savedDarkMode === null && prefersDark)) {
Â  Â  Â  Â  Â  Â  setDarkMode(true);
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  setDarkMode(false);
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- Core App Logic ---
Â  Â  Â  Â  closeBtn.addEventListener('click', () => { window.close(); });
Â  Â  Â  Â  newFileBtn.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  editor.value = '';
Â  Â  Â  Â  Â  Â  currentNoteId = null;
Â  Â  Â  Â  Â  Â  isDirty = false;
Â  Â  Â  Â  Â  Â  updateTitleBar('Untitled');
Â  Â  Â  Â  });
Â  Â  Â  Â  openFileBtn.addEventListener('click', () => { fileOpener.click(); });
Â  Â  Â  Â  fileOpener.addEventListener('change', event => {
Â  Â  Â  Â  Â  Â  const file = event.target.files[0];
Â  Â  Â  Â  Â  Â  if (!file) return;
Â  Â  Â  Â  Â  Â  const reader = new FileReader();
Â  Â  Â  Â  Â  Â  reader.onload = e => { editor.value = e.target.result; };
Â  Â  Â  Â  Â  Â  reader.readAsText(file);
Â  Â  Â  Â  Â  Â  event.target.value = null;Â 
Â  Â  Â  Â  Â  Â  currentNoteId = null;
Â  Â  Â  Â  Â  Â  isDirty = false;
Â  Â  Â  Â  Â  Â  updateTitleBar(file.name.replace(/\.[^/.]+$/, ""));
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  // --- Save Note (Local Storage) Logic ---
Â  Â  Â  Â  const saveNoteToLocalStorage = (name, isAutosave = false) => {
Â  Â  Â  Â  Â  Â  let notes = JSON.parse(localStorage.getItem('afsnote_notes') || '[]');
Â  Â  Â  Â  Â  Â  let noteName = name.trim() || 'Untitled';
Â  Â  Â  Â  Â  Â  let savedNoteName = noteName;

Â  Â  Â  Â  Â  Â  if (currentNoteId) {
Â  Â  Â  Â  Â  Â  Â  Â  const note = notes.find(n => n.id === currentNoteId);
Â  Â  Â  Â  Â  Â  Â  Â  if (note) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  note.content = editor.value;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  note.createdAt = Date.now();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  note.name = noteName;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  savedNoteName = note.name;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  const note = { id: Date.now(), name: noteName, content: editor.value, createdAt: Date.now() };
Â  Â  Â  Â  Â  Â  Â  Â  notes.unshift(note);
Â  Â  Â  Â  Â  Â  Â  Â  currentNoteId = note.id;
Â  Â  Â  Â  Â  Â  Â  Â  savedNoteName = note.name;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  localStorage.setItem('afsnote_notes', JSON.stringify(notes));
Â  Â  Â  Â  Â  Â  isDirty = false;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (isAutosave) {
Â  Â  Â  Â  Â  Â  Â  Â  updateTitleBar(savedNoteName, true);
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  updateTitleBar(savedNoteName);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };
Â  Â  Â  Â  const saveNoteModal = getEl('save-note-modal');
Â  Â  Â  Â  saveNoteBtn.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  if (currentNoteId) {
Â  Â  Â  Â  Â  Â  Â  Â  const notes = JSON.parse(localStorage.getItem('afsnote_notes') || '[]');
Â  Â  Â  Â  Â  Â  Â  Â  const note = notes.find(n => n.id === currentNoteId);
Â  Â  Â  Â  Â  Â  Â  Â  saveNoteToLocalStorage(note.name);
Â  Â  Â  Â  Â  Â  Â  Â  alert('Note updated!');
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  saveNoteModal.style.display = 'flex';
Â  Â  Â  Â  Â  Â  Â  Â  getEl('note-name-input').focus();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  Â  Â  getEl('cancel-note-save-btn').addEventListener('click', () => { saveNoteModal.style.display = 'none'; });
Â  Â  Â  Â  getEl('confirm-note-save-btn').addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  saveNoteToLocalStorage(getEl('note-name-input').value);
Â  Â  Â  Â  Â  Â  saveNoteModal.style.display = 'none';
Â  Â  Â  Â  });

Â  Â  Â  Â  // --- Save to Device Logic ---
Â  Â  Â  Â  const saveToDeviceModal = getEl('save-to-device-modal');
Â  Â  Â  Â  const saveToDevice = (filename, type) => {
Â  Â  Â  Â  Â  Â  let finalFilename = filename.trim() || 'Untitled';
Â  Â  Â  Â  Â  Â  let content = editor.value;
Â  Â  Â  Â  Â  Â  let mimeType = 'text/plain';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Remove extension if already present
Â  Â  Â  Â  Â  Â  finalFilename = finalFilename.replace(/\.(txt|html)$/i, '');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Add appropriate extension and set MIME type
Â  Â  Â  Â  Â  Â  if (type === 'html') {
Â  Â  Â  Â  Â  Â  Â  Â  finalFilename += '.html';
Â  Â  Â  Â  Â  Â  Â  Â  mimeType = 'text/html';
Â  Â  Â  Â  Â  Â  Â  Â  // Ensure basic HTML structure if saving as HTML
Â  Â  Â  Â  Â  Â  Â  Â  if (!content.includes('<html') && !content.includes('<HTML')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  content = `<!DOCTYPE html>
<html>
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <title>${finalFilename.replace('.html', '')}</title>
</head>
<body>
${content}
</body>
</html>`;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  finalFilename += '.txt';
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const blob = new Blob([content], { type: mimeType });
Â  Â  Â  Â  Â  Â  Â  Â  const url = URL.createObjectURL(blob);
Â  Â  Â  Â  Â  Â  Â  Â  const a = document.createElement('a');
Â  Â  Â  Â  Â  Â  Â  Â  a.href = url;
Â  Â  Â  Â  Â  Â  Â  Â  a.download = finalFilename;
Â  Â  Â  Â  Â  Â  Â  Â  document.body.appendChild(a);
Â  Â  Â  Â  Â  Â  Â  Â  a.click();
Â  Â  Â  Â  Â  Â  Â  Â  document.body.removeChild(a);
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => URL.revokeObjectURL(url), 100);
Â  Â  Â  Â  Â  Â  } catch (err) {
Â  Â  Â  Â  Â  Â  Â  Â  alert(`Error saving file: ${err.message}`);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  saveToDeviceBtn.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  saveToDeviceModal.style.display = 'flex';
Â  Â  Â  Â  Â  Â  getEl('device-filename-input').focus();
Â  Â  Â  Â  Â  Â  getEl('device-filename-input').value = ''; // Clear previous input
Â  Â  Â  Â  });
Â  Â  Â  Â  getEl('cancel-device-save-btn').addEventListener('click', () => { saveToDeviceModal.style.display = 'none'; });
Â  Â  Â  Â  getEl('confirm-device-save-btn').addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  const filename = getEl('device-filename-input').value;
Â  Â  Â  Â  Â  Â  const type = getEl('file-type-select').value;
Â  Â  Â  Â  Â  Â  saveToDevice(filename, type);
Â  Â  Â  Â  Â  Â  saveToDeviceModal.style.display = 'none';
Â  Â  Â  Â  });

Â  Â  Â  Â  // --- Other Modals ---
Â  Â  Â  Â  const aboutModal = getEl('about-modal');
Â  Â  Â  Â  aboutMenuBtn.addEventListener('click', () => { aboutModal.style.display = 'flex'; });
Â  Â  Â  Â  getEl('close-modal-1').addEventListener('click', () => aboutModal.style.display = 'none');
Â  Â  Â  Â Â 
Â  Â  Â  Â  const fontSizeModal = getEl('font-size-modal');
Â  Â  Â  Â  fontSizeMenuBtn.addEventListener('click', () => {Â 
Â  Â  Â  Â  Â  Â  const currentSize = parseInt(editor.style.fontSize) || 16;
Â  Â  Â  Â  Â  Â  fontSizeSlider.value = currentSize;
Â  Â  Â  Â  Â  Â  fontSizeDisplay.textContent = `${currentSize}px`;
Â  Â  Â  Â  Â  Â  fontSizeModal.style.display = 'flex';Â 
Â  Â  Â  Â  });
Â  Â  Â  Â  fontSizeSlider.addEventListener('input', e => {Â 
Â  Â  Â  Â  Â  Â  editor.style.fontSize = `${e.target.value}px`;Â 
Â  Â  Â  Â  Â  Â  fontSizeDisplay.textContent = `${e.target.value}px`;
Â  Â  Â  Â  });
Â  Â  Â  Â  getEl('close-font-modal-btn').addEventListener('click', () => { fontSizeModal.style.display = 'none'; });

Â  Â  Â  Â  // --- Replace Logic ---
Â  Â  Â  Â  const replaceModal = getEl('replace-modal');
Â  Â  Â  Â  const findInput = getEl('find-input');
Â  Â  Â  Â  const replaceInput = getEl('replace-input');
Â  Â  Â  Â  const confirmReplaceAllBtn = getEl('confirm-replace-all-btn');
Â  Â  Â  Â  const closeReplaceBtn = getEl('close-replace-btn');
Â  Â  Â  Â Â 
Â  Â  Â  Â  const getFindRegex = (term) => {
Â  Â  Â  Â  Â  Â  const escapedTerm = term.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&');
Â  Â  Â  Â  Â  Â  const pattern = escapedTerm.length === 1 ? `\\b${escapedTerm}\\b` : escapedTerm;
Â  Â  Â  Â  Â  Â  return new RegExp(pattern, 'gi');
Â  Â  Â  Â  };
Â  Â  Â  Â Â 
Â  Â  Â  Â  replaceMenuBtn.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  replaceModal.style.display = 'flex';
Â  Â  Â  Â  Â  Â  findInput.focus();
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  closeReplaceBtn.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  replaceModal.style.display = 'none';
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  confirmReplaceAllBtn.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  const findTerm = findInput.value;
Â  Â  Â  Â  Â  Â  const replaceTerm = replaceInput.value;
Â  Â  Â  Â  Â  Â  if (!findTerm) {
Â  Â  Â  Â  Â  Â  Â  Â  alert("Please enter text to find.");
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  const text = editor.value;
Â  Â  Â  Â  Â  Â  const regex = getFindRegex(findTerm);
Â  Â  Â  Â  Â  Â  if (text.match(regex)) {
Â  Â  Â  Â  Â  Â  Â  Â  editor.value = text.replace(regex, replaceTerm);
Â  Â  Â  Â  Â  Â  Â  Â  alert("All occurrences have been replaced.");
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  alert("Text not found.");
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  // --- Import / Export Logic ---
Â  Â  Â  Â  const ioModal = getEl('import-export-modal');
Â  Â  Â  Â  const importBtn = getEl('import-notes-btn');
Â  Â  Â  Â  const exportBtn = getEl('export-notes-btn');
Â  Â  Â  Â  const closeIoModalBtn = getEl('close-io-modal-btn');
Â  Â  Â  Â  importExportBtn.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  ioModal.style.display = 'flex';
Â  Â  Â  Â  });
Â  Â  Â  Â  closeIoModalBtn.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  ioModal.style.display = 'none';
Â  Â  Â  Â  });
Â  Â  Â  Â  exportBtn.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  const notes = localStorage.getItem('afsnote_notes');
Â  Â  Â  Â  Â  Â  if (!notes || notes === '[]') {
Â  Â  Â  Â  Â  Â  Â  Â  alert("No notes to export.");
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  const now = new Date();
Â  Â  Â  Â  Â  Â  const timestamp = `${now.getFullYear()}${(now.getMonth()+1).toString().padStart(2,'0')}${now.getDate().toString().padStart(2,'0')}_${now.getHours().toString().padStart(2,'0')}${now.getMinutes().toString().padStart(2,'0')}${now.getSeconds().toString().padStart(2,'0')}`;
Â  Â  Â  Â  Â  Â  const filename = `afsnote_export_${timestamp}.json`;
Â  Â  Â  Â  Â  Â  const blob = new Blob([notes], { type: 'application/json' });
Â  Â  Â  Â  Â  Â  const url = URL.createObjectURL(blob);
Â  Â  Â  Â  Â  Â  const a = document.createElement('a');
Â  Â  Â  Â  Â  Â  a.href = url;
Â  Â  Â  Â  Â  Â  a.download = filename;
Â  Â  Â  Â  Â  Â  document.body.appendChild(a);
Â  Â  Â  Â  Â  Â  a.click();
Â  Â  Â  Â  Â  Â  document.body.removeChild(a);
Â  Â  Â  Â  Â  Â  URL.revokeObjectURL(url);
Â  Â  Â  Â  });
Â  Â  Â  Â  importBtn.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  importFileOpener.click();
Â  Â  Â  Â  });
Â  Â  Â  Â  importFileOpener.addEventListener('change', (event) => {
Â  Â  Â  Â  Â  Â  const file = event.target.files[0];
Â  Â  Â  Â  Â  Â  if (!file) return;
Â  Â  Â  Â  Â  Â  const reader = new FileReader();
Â  Â  Â  Â  Â  Â  reader.onload = (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const importedNotes = JSON.parse(e.target.result);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!Array.isArray(importedNotes)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error("Invalid JSON file: Not an array.");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const existingNotes = JSON.parse(localStorage.getItem('afsnote_notes') || '[]');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const combinedNotes = [...existingNotes];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const existingIds = new Set(existingNotes.map(n => n.id));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let importCount = 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  importedNotes.forEach(note => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (note.id && note.name && note.content && note.createdAt && !existingIds.has(note.id)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  combinedNotes.push(note);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  importCount++;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  localStorage.setItem('afsnote_notes', JSON.stringify(combinedNotes));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert(`${importCount} notes imported successfully.`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ioModal.style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  } catch (err) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert(`Error importing notes: ${err.message}`);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  reader.readAsText(file);
Â  Â  Â  Â  Â  Â  event.target.value = null;
Â  Â  Â  Â  });

Â  Â  Â  Â  // --- File Manager Logic ---
Â  Â  Â  Â  const fileManagerWindow = getEl('file-manager-window');
Â  Â  Â  Â  const fileManagerCloseBtn = getEl('file-manager-close-btn');
Â  Â  Â  Â  const fileManagerBackBtn = getEl('file-manager-back-btn');
Â  Â  Â  Â  const notesList = getEl('notes-list');
Â  Â  Â  Â  const notePreview = getEl('note-preview');
Â  Â  Â  Â  const notePreviewTitle = getEl('note-preview-title');
Â  Â  Â  Â  const notePreviewDate = getEl('note-preview-date');
Â  Â  Â  Â  const previewOpenBtn = getEl('preview-open-btn');
Â  Â  Â  Â  const previewDeleteBtn = getEl('preview-delete-btn');
Â  Â  Â  Â  const deleteConfirmModal = getEl('delete-confirm-modal');
Â  Â  Â  Â  const confirmDeleteBtn = getEl('confirm-delete-btn');
Â  Â  Â  Â  const cancelDeleteBtn = getEl('cancel-delete-btn');

Â  Â  Â  Â  const renderNotes = (sortOrder = 'date-desc') => {
Â  Â  Â  Â  Â  Â  let notes = JSON.parse(localStorage.getItem('afsnote_notes') || '[]');
Â  Â  Â  Â  Â  Â  switch(sortOrder) {
Â  Â  Â  Â  Â  Â  Â  Â  case 'name-asc': notes.sort((a, b) => a.name.localeCompare(b.name)); break;
Â  Â  Â  Â  Â  Â  Â  Â  case 'name-desc': notes.sort((a, b) => b.name.localeCompare(a.name)); break;
Â  Â  Â  Â  Â  Â  Â  Â  case 'date-asc': notes.sort((a, b) => a.createdAt - b.createdAt); break;
Â  Â  Â  Â  Â  Â  Â  Â  case 'date-desc': notes.sort((a, b) => b.createdAt - a.createdAt); break;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  notesList.innerHTML = '';
Â  Â  Â  Â  Â  Â  notes.forEach(note => {
Â  Â  Â  Â  Â  Â  Â  Â  const item = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  item.className = 'note-item';
Â  Â  Â  Â  Â  Â  Â  Â  item.dataset.noteId = note.id;
Â  Â  Â  Â  Â  Â  Â  Â  item.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg class="file-icon" viewBox="0 0 16 16" width="16" height="16" fill="currentColor"><path d="M4 0h8l4 4v12H0V0h4zm8 2H2v12h12V4.5L12 2zM5 8h6v1H5V8zm0 2h6v1H5v-1zm0 2h4v1H5v-1z"/></svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="note-item-details">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="note-item-title">${note.name}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="note-item-date">${new Date(note.createdAt).toLocaleString()}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  notesList.appendChild(item);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  };
Â  Â  Â  Â  notesList.addEventListener('click', e => {
Â  Â  Â  Â  Â  Â  const noteItem = e.target.closest('.note-item');
Â  Â  Â  Â  Â  Â  if (!noteItem) return;
Â  Â  Â  Â  Â  Â  const notes = JSON.parse(localStorage.getItem('afsnote_notes') || '[]');
Â  Â  Â  Â  Â  Â  const noteId = Number(noteItem.dataset.noteId);
Â  Â  Â  Â  Â  Â  const note = notes.find(n => n.id === noteId);
Â  Â  Â  Â  Â  Â  document.querySelectorAll('.note-item').forEach(item => item.classList.remove('active'));
Â  Â  Â  Â  Â  Â  noteItem.classList.add('active');
Â  Â  Â  Â  Â  Â  notePreviewTitle.textContent = note.name;
Â  Â  Â  Â  Â  Â  notePreviewDate.textContent = new Date(note.createdAt).toLocaleString();
Â  Â  Â  Â  Â  Â  notePreview.textContent = note.content;
Â  Â  Â  Â  Â  Â  selectedPreviewId = note.id;
Â  Â  Â  Â  });
Â  Â  Â  Â  previewOpenBtn.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  if (!selectedPreviewId) return;
Â  Â  Â  Â  Â  Â  const notes = JSON.parse(localStorage.getItem('afsnote_notes') || '[]');
Â  Â  Â  Â  Â  Â  const note = notes.find(n => n.id === selectedPreviewId);
Â  Â  Â  Â  Â  Â  editor.value = note.content;
Â  Â  Â  Â  Â  Â  currentNoteId = note.id;
Â  Â  Â  Â  Â  Â  isDirty = false;
Â  Â  Â  Â  Â  Â  updateTitleBar(note.name);
Â  Â  Â  Â  Â  Â  fileManagerWindow.style.display = 'none';
Â  Â  Â  Â  });

Â  Â  Â  Â  previewDeleteBtn.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  if (!selectedPreviewId) return;
Â  Â  Â  Â  Â  Â  deleteConfirmModal.style.display = 'flex';
Â  Â  Â  Â  });

Â  Â  Â  Â  cancelDeleteBtn.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  deleteConfirmModal.style.display = 'none';
Â  Â  Â  Â  });

Â  Â  Â  Â  confirmDeleteBtn.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  if (!selectedPreviewId) return;
Â  Â  Â  Â  Â  Â  const notes = JSON.parse(localStorage.getItem('afsnote_notes') || '[]');
Â  Â  Â  Â  Â  Â  const remainingNotes = notes.filter(n => n.id !== selectedPreviewId);
Â  Â  Â  Â  Â  Â  localStorage.setItem('afsnote_notes', JSON.stringify(remainingNotes));
Â  Â  Â  Â  Â  Â  renderNotes();
Â  Â  Â  Â  Â  Â  notePreviewTitle.textContent = '';
Â  Â  Â  Â  Â  Â  notePreviewDate.textContent = '';
Â  Â  Â  Â  Â  Â  notePreview.textContent = 'Select a note to preview...';
Â  Â  Â  Â  Â  Â  selectedPreviewId = null;
Â  Â  Â  Â  Â  Â  deleteConfirmModal.style.display = 'none';
Â  Â  Â  Â  });

Â  Â  Â  Â  savedNotesBtn.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  renderNotes();
Â  Â  Â  Â  Â  Â  notePreviewTitle.textContent = '';
Â  Â  Â  Â  Â  Â  notePreviewDate.textContent = '';
Â  Â  Â  Â  Â  Â  notePreview.textContent = 'Select a note to preview...';
Â  Â  Â  Â  Â  Â  fileManagerWindow.style.display = 'flex';
Â  Â  Â  Â  Â  Â  // Show back button only for mobile themes
Â  Â  Â  Â  Â  Â  const isMobileTheme = document.body.classList.contains('theme-ios') || document.body.classList.contains('theme-android');
Â  Â  Â  Â  Â  Â  fileManagerBackBtn.style.display = isMobileTheme ? 'block' : 'none';
Â  Â  Â  Â  });
Â  Â  Â  Â  const closeFileManager = () => {
Â  Â  Â  Â  Â  Â  fileManagerWindow.style.display = 'none';
Â  Â  Â  Â  };
Â  Â  Â  Â  fileManagerCloseBtn.addEventListener('click', closeFileManager);
Â  Â  Â  Â  fileManagerBackBtn.addEventListener('click', closeFileManager);
Â  Â  Â  Â  document.querySelector('#filter-btn').addEventListener('click', (e) => {
Â  Â  Â  Â  Â  Â  e.stopPropagation();
Â  Â  Â  Â  Â  Â  const dropdown = document.querySelector('#filter-btn').nextElementSibling;
Â  Â  Â  Â  Â  Â  dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
Â  Â  Â  Â  });
Â  Â  Â  Â  document.querySelectorAll('#filter-btn + .dropdown-content li').forEach(item => {
Â  Â  Â  Â  Â  Â  item.addEventListener('click', (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  renderNotes(e.target.dataset.sort);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  });

Â  Â  Â  Â  // --- Autosave & Dirty Flag Logic ---
Â  Â  Â  Â  editor.addEventListener('input', () => {
Â  Â  Â  Â  Â  Â  isDirty = true;
Â  Â  Â  Â  Â  Â  clearTimeout(autosaveTimeout);
Â  Â  Â  Â  Â  Â  autosaveTimeout = setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  if (currentNoteId) { // Only autosave if it's an existing note
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const notes = JSON.parse(localStorage.getItem('afsnote_notes') || '[]');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const note = notes.find(n => n.id === currentNoteId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (note) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  saveNoteToLocalStorage(note.name, true);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }, 1500); // Wait 1.5 seconds after user stops typing
Â  Â  Â  Â  });

Â  Â  Â  Â  // Initialize with default title
Â  Â  Â  Â  updateTitleBar('Untitled');
Â  Â  });

Â  Â  // --- Prevent Refresh on Unsaved Changes ---
Â  Â  window.addEventListener('beforeunload', (e) => {
Â  Â  Â  Â  const editor = document.getElementById('editor');
Â  Â  Â  Â  const isDirty = editor.value && (!editor.dataset.saved || editor.dataset.saved === 'false');
Â  Â  Â  Â  if (isDirty) {
Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  e.returnValue = '';
Â  Â  Â  Â  }
Â  Â  });

Â  Â  if ('serviceWorker' in navigator) {
Â  Â  Â  Â  window.addEventListener('load', () => {
Â  Â  Â  Â  Â  Â  navigator.serviceWorker.register('/sw.js').catch(err => {
Â  Â  Â  Â  Â  Â  Â  Â  console.error('ServiceWorker registration failed: ', err);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  });
Â  Â  }
</script>

</body>
</html>
