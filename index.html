<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Hobopad</title>
    
    <link rel="icon" type="image/x-icon" href="https://busland.neocities.org/hobopad.ico">
    <link rel="manifest" href="manifest.json">

    <style>
        /* --- Base Styles --- */
        html, body { height: 100%; margin: 0; padding: 0; overflow: hidden; font-family: "Tahoma", "Geneva", sans-serif; transition: background-color 0.3s; }
        #app-window, #file-manager-window { width: 100vw; height: 100vh; display: flex; flex-direction: column; box-sizing: border-box; overflow: hidden; }
        .modal-content { width: 100%; display: flex; flex-direction: column; box-sizing: border-box; overflow: hidden; flex-shrink: 1; min-height: 0; }
        .title-bar { display: flex; justify-content: space-between; align-items: center; position: relative; flex-shrink: 0; }
        .window-body { display: flex; flex-direction: column; flex-grow: 1; margin: 0; padding: 0; min-height: 0; }
        .menu-bar { flex-shrink: 0; position: relative; z-index: 10; }
        #editor { flex-grow: 1; padding: 5px; margin: 0; resize: none; outline: none; line-height: 1.6; width: 100%; box-sizing: border-box; overflow-y: scroll; border: none; }
        .modal { display: none; width: 90%; max-width: 340px; max-height: 80vh; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 200; flex-direction: column; }
        #font-size-modal, #replace-modal, #import-export-modal { max-width: 300px; }
        #about-modal {
            width: 680px;
            height: 680px;
            max-width: 90vw;
            max-height: 90vw;
            container-type: inline-size;
        }
        .modal .window-body { overflow-y: auto; padding: 10px; }
        .field-row { display: flex; justify-content: flex-end; gap: 8px; margin-top: 15px; }
        #file-opener, #import-file-opener { display: none; }

        /* --- Custom About Modal Background --- */
        #about-modal .window-body {
            background-image: url('about.png');
            background-size: cover;
            background-position: center;
        }
        #about-modal p {
            color: #222;
            text-shadow: 0 0 4px white, 0 0 6px white;
        }
        #about-modal .window-body p:first-of-type {
            font-size: 3.5cqw;
        }
        #about-modal .window-body p:nth-of-type(2) {
            font-size: 2.5cqw;
        }
        #about-modal .window-body .field-row {
            font-size: 3cqw;
        }


        /* --- Version Display Style --- */
        .version-display {
            font-size: 0.8em;
            font-weight: normal;
            opacity: 0.7;
            padding-right: 5px;
            user-select: none;
        }


        /* --- Font Size Display --- */
        #font-size-display { text-align: center; margin-top: 10px; }

        /* --- Import/Export Styles --- */
        #import-export-modal .window-body { display: flex; flex-wrap: wrap; justify-content: space-around; text-align: center; padding-top: 20px; padding-bottom: 10px; }
        .io-section { width: 45%; margin-bottom: 10px; }
        .io-section button { width: 80px; height: 60px; font-size: 2em; line-height: 1; }
        .io-section p { margin-top: 5px; font-size: 0.9em; }
        .io-warning { width: 100%; color: #888; font-size: 0.8em; text-align: center; margin-top: 15px; }


        /* --- Dropdown Menu Styles --- */
        .menu-item { position: relative; user-select: none; }
        .dropdown-content { display: none; position: absolute; top: 100%; right: 0; background-color: #f9f9f9; min-width: 160px; box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2); z-index: 100; list-style: none; padding: 0; margin: 0; }
        .menu-item:not(.menu-item-right) .dropdown-content { right: auto; left: 0; }
        .dropdown-content li { padding: 8px 12px; cursor: pointer; color: black; border-bottom: 1px solid #ddd; }
        .dropdown-content li:last-child { border-bottom: none; }
        
        
        /* --- File Manager Styles --- */
        #file-manager-window { position: fixed; top: 0; left: 0; z-index: 200; display: none; }
        #file-manager-content { display: flex; flex-grow: 1; min-height: 0; }
        #notes-list-container { width: 40%; display: flex; flex-direction: column; border-right: 1px solid; }
        .notes-list-header { display: flex; padding: 4px 8px; font-weight: bold; border-bottom: 1px solid; flex-shrink: 0; align-items: center; }
        .header-name { flex-grow: 1; }
        #note-preview-container { width: 60%; display: flex; flex-direction: column; }
        #note-preview-header { 
            padding: 8px; 
            border-bottom: 1px solid; 
            flex-shrink: 0; 
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        #note-preview-title { font-weight: bold; font-size: 1.2em; }
        #note-preview-date { font-size: 0.9em; opacity: 0.8; }
        #note-preview-actions { margin-top: 0; display: flex; gap: 8px; }
        #note-preview-actions button, #filter-btn {
            padding: 4px 10px;
            font-size: 14px;
            min-height: initial;
        }
        #note-preview { flex-grow: 1; padding: 10px; overflow-y: auto; white-space: pre-wrap; }
        .note-item { display: flex; align-items: flex-start; padding: 8px; cursor: pointer; border-bottom: 1px solid; gap: 8px; margin-bottom: 5px; }
        .note-item .file-icon { width: 16px; height: 16px; flex-shrink: 0; margin-top: 2px; }
        .note-item-details { flex-grow: 1; display: flex; flex-direction: column; }
        .note-item-title { font-weight: bold; }
        .note-item-date { font-size: 0.9em; opacity: 0.8; }
        
        /* --- Windows 95 Theme --- */
        .theme-win95 body { background: #008080; }
        .theme-win95 #app-window, .theme-win95 .modal-content, .theme-win95 #file-manager-window { background-color: #c0c0c0; border: 3px solid #c0c0c0; border-top-color: #ffffff; border-left-color: #ffffff; border-right-color: #000000; border-bottom-color: #000000; border-radius: 0; box-shadow: none; }
        .theme-win95 .title-bar { background: linear-gradient(90deg, #000080, #1084d0); padding: 3px 5px; color: white; font-weight: bold; height: 20px; border-bottom: none; text-shadow: none; }
        .theme-win95 .title-bar-text { padding: 0 8px; flex-grow: 1; }
        .theme-win95 .menu-bar { display: flex; flex-wrap: wrap; justify-content: flex-end; list-style: none; margin: 0; padding: 2px; border-bottom: 1px solid #868a8e; background: #c0c0c0; gap: 0; }
        .theme-win95 .menu-bar > li { padding: 2px 8px; font-size: 14px; border-radius: 0; border: none; background: none; box-shadow: none; color: black; }
        .theme-win95 .menu-bar > li:hover { background: #000080; color: white; }
        .theme-win95 .window-body { padding: 0; box-shadow: inset -1px -1px #fff, inset 1px 1px #000, inset -2px -2px #868a8e, inset 2px 2px #dfdfdf; }
        .theme-win95 #editor, .theme-win95 #note-preview { background-color: white; border: none; font-family: 'Lucida Console', Courier, monospace; font-size: 16px; margin: 2px; scrollbar-color: #c0c0c0 #DFDFDF; scrollbar-width: auto; }
        .theme-win95 ::-webkit-scrollbar { width: 16px; }
        .theme-win95 ::-webkit-scrollbar-track { background: #DFDFDF; }
        .theme-win95 ::-webkit-scrollbar-thumb { background-color: #c0c0c0; border: 2px outset #c0c0c0; }
        .theme-win95 button, .theme-win95 select, .theme-win95 input[type="text"] { font-family: "Tahoma", sans-serif; font-size: 14px; border: 1px solid; border-color: #fff #000 #000 #fff; box-shadow: inset 1px 1px #dfdfdf, inset -1px -1px #868a8e; background-color: #c0c0c0; border-radius: 0; padding: 4px 15px; min-height: 23px; }
        .theme-win95 button:active { border-color: #000 #fff #fff #000; box-shadow: inset -1px -1px #dfdfdf, inset 1px 1px #868a8e; }
        .theme-win95 .title-bar-controls { display: flex; gap: 3px; }
        .theme-win95 .win-button { width: 16px; height: 14px; min-width: 16px; padding: 0; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 12px; color: black; border-radius: 0; border: 1px solid; border-color: #fff #000 #000 #fff; background-color: #c0c0c0; }
        .theme-win95 .win-button .icon { display: block; color: black; }
        .theme-win95 .minimize-icon { border-bottom: 2px solid black; width: 6px; }
        .theme-win95 .maximize-icon { width: 9px; height: 9px; border: 1px solid black; box-sizing: border-box; }
        .theme-win95 .close-icon { font-family: 'Times New Roman', serif; line-height: 1; }
        .theme-win95 .dropdown-content { border: 1px solid black; border-radius: 0; }
        .theme-win95 .dropdown-content li { border-bottom: 1px solid #868a8e; }
        .theme-win95 .dropdown-content li:hover { background: #000080; color: white; }
        .theme-win95 #about-modal p { color: #222; }
        .theme-win95 #notes-list-container, .theme-win95 .notes-list-header, .theme-win95 .note-item, .theme-win95 #note-preview-header { border-color: #868a8e; }
        .theme-win95 .notes-list-header { border-top: 1px solid #fff; border-left: 1px solid #fff; }
        .theme-win95 .note-item.active { background-color: #000080; color: white; }
        .theme-win95 .note-item.active .file-icon { fill: white; }

        /* --- Windows XP Theme --- */
        .theme-winxp body { background: #D4D0C8; }
        .theme-winxp #app-window, .theme-winxp .modal-content, .theme-winxp #file-manager-window { background-color: #ECE9D8; border: 1px solid #08246B; box-shadow: 0 0 10px rgba(0,0,0,0.5); border-radius: 6px; }
        .theme-winxp .title-bar { background: linear-gradient(to bottom, #0058e1, #3d80f2 4%, #3d80f2 96%, #0058e1); padding: 3px 5px; color: white; font-weight: bold; height: 25px; border-bottom: 1px solid #08246B; font-size: 12px; text-shadow: none; }
        .theme-winxp .title-bar-text { padding: 0 8px; flex-grow: 1; }
        .theme-winxp .menu-bar { display: flex; flex-wrap: wrap; justify-content: flex-end; list-style: none; margin: 0; padding: 2px; background: #ECE9D8; border-bottom: 1px solid #ACA899; gap: 0; }
        .theme-winxp .menu-bar > li { padding: 4px 8px; font-size: 11px; border: 1px solid transparent; border-radius: 0; background: none; box-shadow: none; color: black; }
        .theme-winxp .menu-bar > li:hover { background: #316AC5; color: white; border: 1px solid #000; }
        .theme-winxp .window-body { padding: 3px; box-shadow: none; }
        .theme-winxp #editor, .theme-winxp #note-preview { border: 1px solid #7F9DB9; font-family: 'Lucida Console', Courier, monospace; font-size: 12px; margin: 0; scrollbar-color: #E0E0E0 #F5F5F5; scrollbar-width: auto; }
        .theme-winxp ::-webkit-scrollbar { width: 17px; }
        .theme-winxp ::-webkit-scrollbar-track { background: #F5F5F5; border-left: 1px solid #E0E0E0; }
        .theme-winxp ::-webkit-scrollbar-thumb { background: linear-gradient(to right, #C2D5FC, #D5E1FC, #C2D5FC); border: 1px solid #7F9DB9; }
        .theme-winxp button, .theme-winxp select, .theme-winxp input[type="text"] { font-family: "Tahoma", sans-serif; font-size: 11px; border: 1px solid #08246B; background: #ECE9D8; padding: 3px 12px; min-height: 23px; border-radius: 0; }
        .theme-winxp button:hover, .theme-winxp select:hover { border-color: #f2c9d; background: #fdecae; }
        .theme-winxp .title-bar-controls { display: flex; gap: 3px; }
        .theme-winxp .win-button { width: 21px; height: 21px; min-width: 21px; padding: 0; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 14px; color: white; border-radius: 3px; border: 1px solid #08246B; }
        .theme-winxp #close-btn { background: linear-gradient(to bottom, #fb7c6a, #e1523b); border-color: #94291a; }
        .theme-winxp .win-button:not(#close-btn) { background: linear-gradient(to bottom, #6baff5, #3d83f2); border-color: #08246B; }
        .theme-winxp .win-button .icon { display: block; color: white; }
        .theme-winxp .minimize-icon { border-bottom: 2px solid white; width: 8px; }
        .theme-winxp .maximize-icon { width: 9px; height: 9px; border: 2px solid white; border-top-width: 3px; box-sizing: border-box; }
        .theme-winxp .close-icon { font-family: 'Arial Black', sans-serif; font-weight: 900; line-height: 1; }
        .theme-winxp .dropdown-content { border: 1px solid #ACA899; border-radius: 0; }
        .theme-winxp .dropdown-content li { border-bottom: 1px solid #ACA899; }
        .theme-winxp .dropdown-content li:hover { background: #316AC5; color: white; }
        .theme-winxp #about-modal p { color: #222; }
        .theme-winxp #notes-list-container, .theme-winxp .notes-list-header, .theme-winxp .note-item, .theme-winxp #note-preview-header { border-color: #ACA899; }
        .theme-winxp .note-item.active { background-color: #316AC5; color: white; }
        .theme-winxp .note-item.active .file-icon { fill: white; }

        /* --- Mac OS X Theme --- */
        .theme-macos body { background: #DCDCDC; }
        .theme-macos #app-window, .theme-macos .modal-content, .theme-macos #file-manager-window { background-color: #E8E8E8; background-image: linear-gradient(rgba(0,0,0,0.03) 50%, transparent 50%); background-size: 100% 4px; border: 1px solid #666; border-radius: 8px; box-shadow: 0 5px 25px rgba(0,0,0,0.5); }
        .theme-macos .title-bar { padding: 5px 10px; color: #333; font-weight: bold; height: 22px; border-bottom: 1px solid #B5B5B5; background: rgba(232, 232, 232, 0.8); -webkit-backdrop-filter: blur(10px); backdrop-filter: blur(10px); }
        .theme-macos .title-bar-text { padding: 0 8px; flex-grow: 1; }
        .theme-macos .menu-bar { display: flex; flex-wrap: wrap; justify-content: flex-end; list-style: none; margin: 0; padding: 5px; background: transparent; gap: 5px; }
        .theme-macos .menu-bar > li { padding: 2px 10px; font-size: 12px; border-radius: 15px; border: 1px solid #999; background: linear-gradient(to bottom, #FEFEFE, #F2F2F2); box-shadow: 0 1px 1px rgba(0,0,0,0.1); color: black; }
        .theme-macos .menu-bar > li:hover { background: linear-gradient(to bottom, #4D90FE, #4787ED); color: white; border-color: #3079ED; }
        .theme-macos .window-body { padding: 5px; box-shadow: none; }
        .theme-macos #editor, .theme-macos #note-preview { border: 1px solid #B5B5B5; border-radius: 4px; font-family: 'Monaco', 'Lucida Console', Courier, monospace; font-size: 13px; scrollbar-color: #A8A8A8 #E8E8E8; scrollbar-width: thin; }
        .theme-macos ::-webkit-scrollbar { width: 8px; }
        .theme-macos ::-webkit-scrollbar-track { background: #E8E8E8; }
        .theme-macos ::-webkit-scrollbar-thumb { background-color: #A8A8A8; border-radius: 4px; }
        .theme-macos button, .theme-macos select, .theme-macos input[type="text"] { font-family: "Lucida Grande", sans-serif; font-size: 13px; border: 1px solid #999; border-radius: 15px; background: linear-gradient(to bottom, #FEFEFE, #F2F2F2); box-shadow: 0 1px 1px rgba(0,0,0,0.1); padding: 4px 15px; min-height: 26px; }
        .theme-macos button:hover { border-color: #777; }
        .theme-macos button.primary { background: linear-gradient(to bottom, #4D90FE, #4787ED); color: white; border-color: #3079ED; }
        .theme-macos .title-bar-controls { display: flex; gap: 8px; }
        .theme-macos .win-button { width: 12px; height: 12px; min-width: 12px; padding: 0; border-radius: 50%; border: 1px solid rgba(0,0,0,0.2); display: flex; align-items: center; justify-content: center; }
        .theme-macos .win-button .icon { display: none; }
        .theme-macos .win-button:hover .icon { display: block; color: rgba(0,0,0,0.5); font-weight: bold; font-size: 9px; line-height: 1; }
        .theme-macos #close-btn { background-color: #FF5F57; border-color: #E0443E; }
        .theme-macos #minimize-btn { background-color: #FEBC2E; border-color: #E0A123; }
        .theme-macos #maximize-btn { background-color: #28C840; border-color: #1DAD29; }
        .theme-macos .dropdown-content { border: 1px solid #B5B5B5; border-radius: 4px; }
        .theme-macos .dropdown-content li { border-bottom: 1px solid #B5B5B5; }
        .theme-macos .dropdown-content li:hover { background: #3079ED; color: white; }
        .theme-macos #about-modal p { color: #222; }
        .theme-macos #notes-list-container, .theme-macos .notes-list-header, .theme-macos .note-item, .theme-macos #note-preview-header { border-color: #B5B5B5; }
        .theme-macos .note-item.active { background-color: #3079ED; color: white; }
        .theme-macos .note-item.active .file-icon { fill: white; }

        /* --- iOS Theme --- */
        .theme-ios body { background: #f0f0f0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; }
        .theme-ios #app-window, .theme-ios .modal-content, .theme-ios #file-manager-window { background-color: #ffffff; border: 1px solid #d1d1d6; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .theme-ios .title-bar { background: #f7f7f7; padding: 10px; color: #000; font-weight: 600; height: auto; border-bottom: 1px solid #d1d1d6; }
        .theme-ios .title-bar-text { font-size: 17px; text-align: center; flex-grow: 1; }
        .theme-ios .menu-bar { display: flex; flex-wrap: wrap; justify-content: flex-end; list-style: none; margin: 0; padding: 8px; background: #f7f7f7; gap: 4px; border-bottom: 1px solid #d1d1d6; }
        .theme-ios .menu-bar > li { padding: 5px 10px; font-size: 14px; font-weight: bold; border-radius: 8px; border: none; background: none; box-shadow: none; color: #007aff; cursor: pointer; }
        .theme-ios .menu-bar > li:hover { background: #e5e5ea; }
        .theme-ios .window-body { padding: 0; box-shadow: none; background-color: #fff; }
        .theme-ios #editor, .theme-ios #note-preview { background-color: #fff; border: none; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; font-size: 17px; padding: 12px; line-height: 1.5; color: #000; }
        .theme-ios ::-webkit-scrollbar { width: 8px; }
        .theme-ios ::-webkit-scrollbar-track { background: transparent; }
        .theme-ios ::-webkit-scrollbar-thumb { background-color: #c7c7cc; border-radius: 4px; }
        .theme-ios button, .theme-ios select, .theme-ios input[type="text"] { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; font-size: 17px; border: 1px solid #d1d1d6; background-color: #fff; border-radius: 8px; padding: 8px 12px; min-height: 36px; }
        .theme-ios button { background-color: #007aff; color: white; border: none; }
        .theme-ios button:active { background-color: #005bb5; }
        .theme-ios button.primary { background-color: #34c759; }
        .theme-ios button.primary:active { background-color: #2ca049; }
        .theme-ios .title-bar-controls { display: none; } /* Hide old controls */
        .theme-ios .dropdown-content { border: 1px solid #d1d1d6; border-radius: 8px; background-color: #fff; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .theme-ios .dropdown-content li { color: #007aff; border-bottom: 1px solid #d1d1d6; }
        .theme-ios .dropdown-content li:hover { background: #f0f0f0; color: #005bb5; }
        .theme-ios #about-modal p { color: #222; }
        .theme-ios #notes-list-container, .theme-ios .notes-list-header, .theme-ios .note-item, .theme-ios #note-preview-header { border-color: #d1d1d6; }
        .theme-ios .notes-list-header { background-color: #f7f7f7; }
        .theme-ios .note-item.active { background-color: #e5f1ff; color: #007aff; }
        .theme-ios .note-item.active .file-icon { fill: #007aff; }
        .theme-ios .file-icon { fill: #6c6c70; }
        .theme-ios #file-manager-window .title-bar-controls { display: none; }
        .theme-ios #file-manager-back-btn-ios { display: block; background: none; border: none; color: #007aff; font-size: 17px; font-weight: 400; padding: 0 10px; cursor: pointer; }
        #file-manager-back-btn-ios, #file-manager-back-btn-android { display: none; } /* Hide by default */

        /* --- Android Theme --- */
        .theme-android body { background-color: #fafafa; font-family: 'Roboto', sans-serif; }
        .theme-android #app-window, .theme-android .modal-content, .theme-android #file-manager-window { background-color: #ffffff; border: 1px solid #e0e0e0; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .theme-android .title-bar { background: #ffffff; padding: 12px 16px; color: #202124; font-weight: 500; height: auto; border-bottom: 1px solid #e0e0e0; }
        .theme-android .title-bar-text { font-size: 18px; text-align: left; flex-grow: 1; }
        .theme-android .menu-bar { display: flex; flex-wrap: wrap; justify-content: flex-end; list-style: none; margin: 0; padding: 8px; background: #ffffff; gap: 4px; border-bottom: 1px solid #e0e0e0; }
        .theme-android .menu-bar > li { padding: 6px 10px; font-size: 13px; border-radius: 20px; border: 1px solid #dadce0; background: #f1f3f4; box-shadow: none; color: #3c4043; cursor: pointer; }
        .theme-android .menu-bar > li:hover { background: #e8eaed; }
        .theme-android .window-body { padding: 0; box-shadow: none; background-color: #fff; }
        .theme-android #editor, .theme-android #note-preview { background-color: #fff; border: none; font-family: 'Roboto', sans-serif; font-size: 16px; padding: 16px; line-height: 1.6; color: #202124; }
        .theme-android ::-webkit-scrollbar { width: 8px; }
        .theme-android ::-webkit-scrollbar-track { background: transparent; }
        .theme-android ::-webkit-scrollbar-thumb { background-color: #dadce0; border-radius: 4px; }
        .theme-android button, .theme-android select, .theme-android input[type="text"] { font-family: 'Roboto', sans-serif; font-size: 14px; border: 1px solid #dadce0; background-color: #f1f3f4; border-radius: 8px; padding: 10px 14px; min-height: 40px; }
        .theme-android button { background-color: #1a73e8; color: white; border: none; font-weight: 500; }
        .theme-android button:active { background-color: #185abc; }
        .theme-android button.primary { background-color: #1a73e8; }
        .theme-android button.primary:active { background-color: #185abc; }
        .theme-android .title-bar-controls { display: none; } /* Hide old controls */
        .theme-android .dropdown-content { border: 1px solid #e0e0e0; border-radius: 8px; background-color: #fff; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .theme-android .dropdown-content li { color: #3c4043; border-bottom: 1px solid #e0e0e0; }
        .theme-android .dropdown-content li:hover { background: #f1f3f4; }
        .theme-android #about-modal p { color: #222; }
        .theme-android #notes-list-container, .theme-android .notes-list-header, .theme-android .note-item, .theme-android #note-preview-header { border-color: #e0e0e0; }
        .theme-android .notes-list-header { background-color: #f8f9fa; }
        .theme-android .note-item.active { background-color: #e8f0fe; }
        .theme-android .note-item.active .file-icon { fill: #1a73e8; }
        .theme-android .file-icon { fill: #5f6368; }
        .theme-android #file-manager-window .title-bar { justify-content: flex-start; gap: 8px; }
        .theme-android #file-manager-window .title-bar-controls { display: none; }
        .theme-android #file-manager-back-btn-android { display: flex; align-items: center; justify-content: center; background: none; border: none; padding: 8px; border-radius: 50%; cursor: pointer; }
        .theme-android #file-manager-back-btn-android:hover { background-color: rgba(0,0,0,0.05); }
        .theme-android #file-manager-back-btn-android svg { width: 24px; height: 24px; fill: #5f6368; }
        .theme-android #file-manager-back-btn-android { display: block; }

        /* --- Dark Mode Overrides --- */
        body.dark-mode { background-color: #121212; }
        .dark-mode #app-window, .dark-mode .modal-content, .dark-mode #file-manager-window, .dark-mode .dropdown-content { background-color: #1e1e1e; color: #e0e0e0; }
        .dark-mode #font-size-modal .modal-content { background-color: #1e1e1e; }
        .dark-mode .title-bar { background: #2c2c2c; color: #e0e0e0; border-bottom-color: #3c3c3c; }
        .dark-mode .menu-bar { background: #2c2c2c; border-bottom-color: #3c3c3c; }
        .dark-mode .menu-bar > li { background: #3c3c3c; color: #e0e0e0; border-color: #555; }
        .dark-mode .menu-bar > li:hover { background: #555; }
        .dark-mode #editor, .dark-mode #note-preview, .dark-mode input, .dark-mode select { background-color: #2c2c2c; color: #e0e0e0; border-color: #555; }
        .dark-mode button { background-color: #007aff; color: #fff; }
        .dark-mode button:active { background-color: #005bb5; }
        .dark-mode .dropdown-content li { color: #e0e0e0; border-bottom-color: #3c3c3c; }
        .dark-mode .dropdown-content li:hover { background: #3c3c3c; }
        .dark-mode .note-item { border-bottom-color: #3c3c3c; }
        .dark-mode .note-item.active { background-color: #007aff; color: #fff; }
        .dark-mode .file-icon { fill: #e0e0e0; }
        .dark-mode .note-item.active .file-icon { fill: #fff; }
        
        /* Dark mode for iOS */
        .dark-mode.theme-ios #app-window, .dark-mode.theme-ios .modal-content, .dark-mode.theme-ios #file-manager-window { background-color: #000; border-color: #333; }
        .dark-mode.theme-ios .title-bar, .dark-mode.theme-ios .menu-bar { background: #1c1c1e; border-bottom-color: #333; }
        .dark-mode.theme-ios .title-bar-text, .dark-mode.theme-ios p { color: #fff; }
        .dark-mode.theme-ios .menu-bar > li { color: #0a84ff; }
        .dark-mode.theme-ios .menu-bar > li:hover { background: #2c2c2e; }
        .dark-mode.theme-ios #editor, .dark-mode.theme-ios #note-preview, .dark-mode.theme-ios input, .dark-mode.theme-ios select { background-color: #000; color: #fff; border-color: #333; }
        .dark-mode.theme-ios .dropdown-content { background-color: #1c1c1e; }
        .dark-mode.theme-ios .dropdown-content li { color: #0a84ff; border-bottom-color: #333; }
        .dark-mode.theme-ios .dropdown-content li:hover { background: #2c2c2e; }
        .dark-mode.theme-ios #about-modal p { text-shadow: 0 0 5px #000, 0 0 8px #000; color: #fff; }
        .dark-mode.theme-ios #font-size-modal .modal-content { background-color: #1c1c1e; }
        .dark-mode.theme-ios #file-manager-window .window-body { background-color: #000; }
        .dark-mode.theme-ios .note-item.active { background-color: #0a84ff; }


        /* Dark mode for Android */
        .dark-mode.theme-android body { background-color: #121212; }
        .dark-mode.theme-android #app-window, .dark-mode.theme-android .modal-content, .dark-mode.theme-android #file-manager-window { background-color: #1e1e1e; border-color: #333; }
        .dark-mode.theme-android .title-bar, .dark-mode.theme-android .menu-bar { background: #2c2c2c; border-bottom-color: #333; }
        .dark-mode.theme-android .title-bar-text, .dark-mode.theme-android p { color: #e0e0e0; }
        .dark-mode.theme-android .menu-bar > li { background: #3c3c3c; color: #e0e0e0; border-color: #555; }
        .dark-mode.theme-android .menu-bar > li:hover { background: #555; }
        .dark-mode.theme-android #editor, .dark-mode.theme-android #note-preview, .dark-mode.theme-android input, .dark-mode.theme-android select { background-color: #1e1e1e; color: #e0e0e0; border-color: #555; }
        .dark-mode.theme-android .dropdown-content { background-color: #2c2c2c; }
        .dark-mode.theme-android .dropdown-content li { color: #e0e0e0; border-bottom-color: #333; }
        .dark-mode.theme-android .dropdown-content li:hover { background: #3c3c3c; }
        .dark-mode.theme-android #about-modal p { text-shadow: 0 0 5px #000, 0 0 8px #000; color: #fff; }
        .dark-mode.theme-android #font-size-modal .modal-content { background-color: #1e1e1e; }
        .dark-mode.theme-android #file-manager-window .window-body { background-color: #1e1e1e; }
        .dark-mode.theme-android .note-item.active { background-color: #8ab4f8; color: #202124; }
        .dark-mode.theme-android .note-item.active .file-icon { fill: #202124; }

        @media (max-width: 640px) {
            #about-modal {
                width: 90vw;
                height: 90vw;
                max-width: none;
                max-height: none;
            }
            #about-modal .modal-content {
                height: 100%;
            }
        }

        /* --- FIX: iOS Dark Mode Backgrounds --- */
        .dark-mode.theme-ios .modal .window-body {
            background-color: #1c1c1e;
        }
        .dark-mode.theme-ios .notes-list-header {
            background-color: #1c1c1e;
        }

        /* --- FIX: Android Dark Mode Backgrounds --- */
        .dark-mode.theme-android .modal .window-body {
            background-color: #1e1e1e;
        }
        .dark-mode.theme-android .notes-list-header {
            background-color: #2c2c2c;
        }

        /* --- FIX: Dark Mode Input Boxes --- */
        .dark-mode.theme-win95 input[type="text"],
        .dark-mode.theme-win95 select,
        .dark-mode.theme-winxp input[type="text"],
        .dark-mode.theme-winxp select,
        .dark-mode.theme-macos input[type="text"],
        .dark-mode.theme-macos select {
            background-color: #2c2c2c;
            color: #e0e0e0;
            border: 1px solid #555;
            box-shadow: none;
            background-image: none;
        }


    </style>
</head>
<body class="theme-android">

<div id="app-window">
    <div class="title-bar">
        <div class="title-bar-text">Hobopad</div>
        <div class="title-bar-controls">
            <button id="minimize-btn" class="win-button" aria-label="Minimize"><span class="icon minimize-icon">−</span></button>
            <button id="maximize-btn" class="win-button" aria-label="Maximize"><span class="icon maximize-icon">+</span></button>
            <button id="close-btn" class="win-button" aria-label="Close"><span class="icon close-icon">×</span></button>
        </div>
    </div>
    <ul class="menu-bar">
        <li class="menu-item">
            File
            <ul class="dropdown-content">
                <li id="new-file-btn">New Note</li>
                <li id="open-file-btn">Open from Device...</li>
                <li id="save-note-btn">Save Note</li>
                <li id="save-to-device-btn">Save to Device...</li>
                <li id="check-for-update-btn">Check for Updates</li>
            </ul>
        </li>
        <li id="saved-notes-btn">Saved Notes</li>
        <li class="menu-item menu-item-right">
            Styles
            <ul class="dropdown-content">
                <li id="theme-win95-btn">Windows 95</li>
                <li id="theme-winxp-btn">Windows XP</li>
                <li id="theme-macos-btn">Mac OS X</li>
                <li id="theme-ios-btn">iOS</li>
                <li id="theme-android-btn">Android</li>
            </ul>
        </li>
        <li class="menu-item menu-item-right">
            Tools
            <ul class="dropdown-content">
                <li id="font-size-menu-btn">Font Size</li>
                <li id="replace-menu-btn">Replace</li>
                <li id="import-export-btn">Import/Export</li>
                <li id="dark-mode-toggle">Light Mode</li>
                <li id="about-menu-btn">About</li>
            </ul>
        </li>
    </ul>
    <div class="window-body">
        <textarea id="editor" spellcheck="false"></textarea>
    </div>
</div>

<div id="about-modal" class="modal">
    <div class="modal-content">
        <div class="title-bar">
            <div class="title-bar-text">About Hobopad</div>
            <div class="version-display">[Version 1.1.5](Hedonismbot)</div>
        </div>
        <div class="window-body">
            <p style="text-align: center; margin: 20px;">
                This shitty app was vibe coded by an absolute complete dumbass who was sick of all your shitty note apps....<br><br>
                Like who the fuck wants a note taking app to open DIRECTLY to the saved notes, showing you every single note with just enough of a snippet to raise suspicion.<br><br>
                Get 
                better you fucking weirdos.
            </p>
            <p style="text-align: center; margin: 10px;">Oh and if you lose your saved notes, that's 100% on you bud, don't blame me, dumbass.</p>
            <section class="field-row"><button id="close-modal-1">get fucked</button><button id="close-modal-2" class="primary">dumbass</button></section>
        </div>
    </div>
</div>

<div id="update-modal" class="modal">
    <div class="modal-content">
        <div class="title-bar"><div class="title-bar-text">Restart to Update</div></div>
        <div class="window-body">
            <p id="update-modal-text" style="margin-bottom: 20px;">A new version of Hobopad has been downloaded.</p>
            <section class="field-row">
                <button id="update-later-btn">Later</button>
                <button id="update-now-btn" class="primary">Restart Now</button>
            </section>
        </div>
    </div>
</div>

<div id="save-note-modal" class="modal"></div>
<div id="save-to-device-modal" class="modal"></div>
<div id="font-size-modal" class="modal"></div>
<div id="replace-modal" class="modal"></div>
<div id="import-export-modal" class="modal"></div>

<input type="file" id="file-opener" accept=".txt,text/plain">
<input type="file" id="import-file-opener" accept=".json,application/json">
<div id="file-manager-window"></div>

<script>
    let currentNoteId = null;
    let isDirty = false;
    let autosaveTimeout = null;
    let newWorker;
    let currentNoteName = 'Untitled';

    const getEl = id => document.getElementById(id);

    const updateTitleBar = (noteName, notification = null, duration = 3000) => {
        currentNoteName = noteName || currentNoteName;
        const titleBarText = document.querySelector('#app-window .title-bar-text');
        let title = `${currentNoteName} - Hobopad`;
        
        if (notification) {
            title = `${notification} | ${title}`;
            setTimeout(() => {
                if (titleBarText.textContent.startsWith(notification)) {
                    titleBarText.textContent = `${currentNoteName} - Hobopad`;
                }
            }, duration);
        }
        titleBarText.textContent = title;
    };
    
    document.addEventListener('DOMContentLoaded', () => {
        const editor = getEl('editor');
        
        // --- Dropdown Menu Logic ---
        const closeAllDropdowns = () => {
            document.querySelectorAll('.dropdown-content').forEach(d => d.style.display = 'none');
        };
        document.querySelectorAll('.menu-item').forEach(item => {
            const hasDropdown = item.querySelector('.dropdown-content');
            item.addEventListener('click', event => {
                if (hasDropdown && event.target.closest('.dropdown-content')) return;
                event.stopPropagation();
                const isVisible = hasDropdown ? hasDropdown.style.display === 'block' : false;
                closeAllDropdowns();
                if (hasDropdown && !isVisible) {
                    hasDropdown.style.display = 'block';
                }
            });
        });
        document.querySelectorAll('.dropdown-content li').forEach(item => {
            item.addEventListener('click', closeAllDropdowns);
        });
        window.addEventListener('click', closeAllDropdowns);

        // --- Attach All Event Listeners ---
        getEl('check-for-update-btn').addEventListener('click', () => checkForUpdates(true));
        getEl('new-file-btn').addEventListener('click', () => {
            editor.value = '';
            currentNoteId = null;
            isDirty = false;
            updateTitleBar('Untitled');
        });
        getEl('about-menu-btn').addEventListener('click', () => getEl('about-modal').style.display = 'flex');
        getEl('close-modal-1').addEventListener('click', () => getEl('about-modal').style.display = 'none');
        getEl('close-modal-2').addEventListener('click', () => getEl('about-modal').style.display = 'none');
        // Add other listeners for themes, file operations, modals here...
        // This is a minimal set to ensure the popups work.
        getEl('font-size-menu-btn').addEventListener('click', () => getEl('font-size-modal').style.display = 'flex');
        getEl('replace-menu-btn').addEventListener('click', () => getEl('replace-modal').style.display = 'flex');
        getEl('import-export-btn').addEventListener('click', () => getEl('import-export-modal').style.display = 'flex');
        getEl('save-note-btn').addEventListener('click', () => getEl('save-note-modal').style.display = 'flex');


        // --- Initial Title & Update Check ---
        updateTitleBar('Untitled');
        if (sessionStorage.getItem('updateApplied')) {
            updateTitleBar(null, 'Update successful!', 4000);
            sessionStorage.removeItem('updateApplied');
        }
    });

    // --- Update Logic ---
    function showUpdatePrompt(worker) {
        newWorker = worker;
        const updateModal = getEl('update-modal');
        getEl('update-now-btn').onclick = () => {
            sessionStorage.setItem('updateApplied', 'true');
            newWorker.postMessage({ type: 'SKIP_WAITING' });
        };
        getEl('update-later-btn').onclick = () => {
            updateModal.style.display = 'none';
        };
        updateModal.style.display = 'flex';
    }

    async function checkForUpdates(manualCheck = false) {
        if (!('serviceWorker' in navigator)) return;
        try {
            const reg = await navigator.serviceWorker.getRegistration();
            if (!reg) {
                if (manualCheck) updateTitleBar(null, "Cannot check for updates.", 4000);
                return;
            }

            const res = await fetch('/version.json', { cache: 'no-cache' });
            const serverVersionData = await res.json();
            const versionDisplay = document.querySelector('.version-display');
            const clientVersion = versionDisplay.textContent.match(/\[Version ([\d\.]+)\]/)[1];

            if (serverVersionData.version > clientVersion) {
                updateTitleBar(null, "Update found, downloading...", 2000);
                await reg.update();
            } else if (manualCheck) {
                updateTitleBar(null, "Hobopad is up to date.", 3000);
            }
        } catch (error) {
            console.error("Update check failed:", error);
            if (manualCheck) updateTitleBar(null, "Update check failed.", 3000);
        }
    }

    // --- Service Worker Registration & Listeners ---
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/sw.js').then(reg => {
            reg.addEventListener('updatefound', () => {
                const installingWorker = reg.installing;
                installingWorker.addEventListener('statechange', () => {
                    if (installingWorker.state === 'installed' && navigator.serviceWorker.controller) {
                        showUpdatePrompt(installingWorker);
                    }
                });
            });
        }).catch(err => console.error('ServiceWorker registration failed: ', err));

        let refreshing;
        navigator.serviceWorker.addEventListener('controllerchange', () => {
            if (refreshing) return;
            window.location.reload();
            refreshing = true;
        });
    }
</script>

</body>
</html>
